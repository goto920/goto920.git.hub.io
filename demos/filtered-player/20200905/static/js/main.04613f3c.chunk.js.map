{"version":3,"sources":["effectorClass.js","App.js","serviceWorker.js","index.js"],"names":["Effector","audioCtx","shiftSize","inputAudio","this","sampleRate","rfft","FFTR","fftObjBuffer","lastInput","Float32Array","fill","lastOut","filterChain","calcFFT","bind","justFFT","calcPan","calcPerc","fftFilter","addFilter","clearAllFilter","presetFilter","fromPan","fromFreq","toPan","toFreq","action","fromFreqIndex","Math","min","round","toFreqIndex","push","length","inputBuffer","outputBuffer","channel","numberOfChannels","inputData","getChannelData","outputData","AudioBuffer","prototype","copyToChannel","sample","type","option","width","console","log","fftWindowInput","fftObj","pcmData","fftCoef","inverse","slice","forward","Windowing","hann","power","freqBin","pan","panAmp","percL","percR","fft","numCoef","base","innerProd","crossProd","abs","sqrt","pow","absL","absR","absLR","frac","max","isNaN","median","arr","mid","floor","nums","sort","a","b","buflen","from","to","pMedianL","pMedianR","powerArrayL","powerArrayR","time","hMedianL","hMedianR","retval","perc","splice","fftL","fftR","outL","outR","i","filter","f","version","packageJSON","homepage","subversion","jaText","messages","ja","usText","us","m","window","AudioContext","webkitAudioContext","gainNode","effector","iOS","navigator","userAgent","match","App","props","params","filename","currentSource","isPlaying","effectNode","fftShift","filterType","vocalWidth","counter","state","playingAt","playVolume","startButtonStr","loadFile","handleLang","handleTimeSlider","handleVolumeSlider","handlePlay","handleSave","selectFilter","fakeDownload","event","close","createGain","addEventListener","handleWindowClose","removeEventListener","duration","startBStyle","color","className","title","name","onClick","accept","onChange","defaultValue","value","toFixed","step","style","href","target","rel","guide","e","files","file","reader","FileReader","onload","decodeAudioData","result","audioBuffer","setState","error","err","readAsArrayBuffer","vol","parseInt","gain","parseFloat","source","buffer","createBuffer","createBufferSource","connect","destination","start","original","modified","channels","bufferSize","createJavaScriptNode","createScriptProcessor","onaudioprocess","process","stop","disconnect","onaudioprrocess","outFileName","split","playSpeed","playPitch","blob","Blob","toWav","saveAs","Component","Boolean","location","hostname","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.04613f3c.chunk.js","sourcesContent":["// import {RFFT} from 'fftw-js'; // fftw-js\nimport {FFTR} from 'kissfft-js';\nimport Windowing from 'fft-windowing';\n\nclass Effector {\n\n  constructor(audioCtx,shiftSize,inputAudio){\n    this.audioCtx = audioCtx;\n    this.shiftSize = shiftSize;\n    this.sampleRate = inputAudio.sampleRate;\n\n//    this.rfft = new RFFT(2*this.shiftSize); // fftw-js\n    this.rfft = new FFTR(2*this.shiftSize); // kissfft-js\n\n    this.fftObjBuffer = []; // up to 17\n\n    this.lastInput = [];\n    this.lastInput[0] = new Float32Array(shiftSize).fill(0);\n    this.lastInput[1] = new Float32Array(shiftSize).fill(0);\n\n    this.lastOut = [];\n    this.lastOut[0] = new Float32Array(shiftSize).fill(0);\n    this.lastOut[1] = new Float32Array(shiftSize).fill(0);\n\n    this.filterChain = []; \n       // fromPan, fromFreq, toPan, toFreq, action \n       // ('T': through, 'M': mute, 'P': percussive, 'H': harmonic)\n\n    this.calcFFT = this.calcFFT.bind(this); // forward FFT \n    this.justFFT = this.justFFT.bind(this); // forward FFT \n    this.calcPan = this.calcPan.bind(this); // Pan calculation\n    this.calcPerc = this.calcPerc.bind(this);\n    this.fftFilter = this.fftFilter.bind(this);\n\n    this.addFilter = this.addFilter.bind(this);\n    this.clearAllFilter = this.clearAllFilter.bind(this);\n\n    this.presetFilter = this.presetFilter.bind(this);\n\n  }\n\n  addFilter(fromPan, fromFreq, toPan, toFreq, action){ \n\n    let fromFreqIndex = Math.min(this.shiftSize, \n            Math.round(this.shiftSize*(2*fromFreq/this.sampleRate)));\n    let toFreqIndex = Math.min(this.shiftSize, \n            Math.round(this.shiftSize*(2*toFreq/this.sampleRate)));\n\n    this.filterChain.push({\n      fromPan: fromPan, fromFreqIndex: fromFreqIndex,\n      toPan: toPan, toFreqIndex: toFreqIndex,\n      action: action\n    });\n\n  }\n\n  clearAllFilter(){ this.filterChain.length = 0; }\n\n  copy(inputBuffer, outputBuffer){ // for test\n\n    for (let channel = 0; channel < inputBuffer.numberOfChannels;\n           channel++){\n      let inputData = inputBuffer.getChannelData(channel);\n      let outputData = outputBuffer.getChannelData(channel);\n\n      if (AudioBuffer.prototype.copyToChannel)\n          outputBuffer.copyToChannel(inputData, channel,0);\n      else \n         for (let sample = 0; sample < inputBuffer.length; sample++)\n              outputData[sample] = inputData[sample];\n\n    } // end for channel\n    return;\n  }\n\n  presetFilter(type, option){\n\n     this.clearAllFilter();\n     console.log('filter, option ', type, option);\n\n     let width;\n     switch (type){\n       case 'bypass': break;\n       case 'drumCover':\n         width = option;\n         this.addFilter(-1,0,1,30000,\"H\");\n         this.addFilter(-width/2,220,width/2,4000,\"T\");\n         this.addFilter(-1.0,220,-0.9,4000,\"T\");\n         this.addFilter(0.9,220,1.0,4000,\"T\");\n       break;\n       case 'karaokeMale':\n         width = option;\n         this.addFilter(-width/2,220,width/2,8000,\"M\");\n       break;\n       case 'karaokeFemale':\n         width = option;\n         this.addFilter(-width/2,350,width/2,8000,\"M\");\n       break;\n       case 'percussive':\n         this.addFilter(-1,0,1,30000,\"P\");\n       break;\n       case 'harmonic':\n         this.addFilter(-1,0,1,30000,\"H\");\n       break;\n       default:\n     }\n  }\n\n  process(inputBuffer, outputBuffer){\n\n    if (inputBuffer.numberOfChannels !== 2) return;\n\n// prepare input\n// FFT window = 2*this.shiftSize window = 2*this.shiftSize\n// channel: 0(left), 1(right)\n    let fftWindowInput = [];\n       fftWindowInput[0] = new Float32Array(this.shiftSize*2);\n       fftWindowInput[1] = new Float32Array(this.shiftSize*2);\n\n    for (let channel = 0; channel <= 1 ; channel++){\n\n      let inputData = inputBuffer.getChannelData(channel);\n\n      for (let sample = 0; sample < 2*this.shiftSize; sample++){ \n        if (sample < this.shiftSize) \n          fftWindowInput[channel][sample] = this.lastInput[channel][sample];\n        else if (sample < this.shiftSize + inputData.length) \n          fftWindowInput[channel][sample] = inputData[sample - this.shiftSize];\n        else fftWindowInput[channel][sample] = 0;\n      }\n\n      for (let sample = 0; sample < this.shiftSize; sample++) \n        this.lastInput[channel][sample] \n          = fftWindowInput[channel][this.shiftSize + sample];\n\n    } // end for channel\n\n    let fftObj = this.calcFFT(fftWindowInput);\n    // fftObj is null until the buffer has 17 fftObj's\n\n// decode FFT\n    let pcmData = []; // this.shiftSize*2  \n\n//    let fftCoef = this.justFFT(fftWindowInput); // test\n\n    if (fftObj !== null) {\n      let fftCoef = this.fftFilter(fftObj);\n\n       pcmData[0] = this.rfft.inverse(fftCoef[0]).slice(); \n       pcmData[1] = this.rfft.inverse(fftCoef[1]).slice();\n\n       // console.log(pcmData[0]);\n\n    } else {\n       // console.log ('fftObj is null');\n       pcmData[0] = new Float32Array(this.shiftSize*2 + 2).fill(0);\n       pcmData[1] = new Float32Array(this.shiftSize*2 + 2).fill(0);\n    }\n\n// Add two outputs in overlapped hann window \n    for(let channel = 0; channel <= 1; channel++){\n      let outputData = outputBuffer.getChannelData(channel);\n\n      for (let sample = 0; sample < this.shiftSize; sample++)\n         outputData[sample] = this.lastOut[channel][sample] \n           + pcmData[channel][sample]/(2*this.shiftSize);\n\n      for (let sample = 0; sample < this.shiftSize; sample++)\n         this.lastOut[channel][sample] \n           = pcmData[channel][this.shiftSize + sample]/(2*this.shiftSize);\n      // store latter half of fft inverse output\n\n    }\n\n    return;\n  }\n\n  justFFT (fftWindowInput){\n\n     // console.log(fftWindowInput[0]);\n\n    let fftCoef = [];\n    fftCoef[0] = this.rfft.forward(Windowing.hann(fftWindowInput[0])).slice();\n    fftCoef[1] = this.rfft.forward(Windowing.hann(fftWindowInput[1])).slice();\n\n    return fftCoef;\n  }\n\n  calcFFT (fftWindowInput){\n\n    let fftCoef = [];\n    fftCoef[0] = this.rfft.forward(Windowing.hann(fftWindowInput[0])).slice();\n    fftCoef[1] = this.rfft.forward(Windowing.hann(fftWindowInput[1])).slice();\n    // 0: Left, 1: Right\n\n    let power = [];\n      power[0] = new Float32Array(this.shiftSize+1)\n      power[1] = new Float32Array(this.shiftSize+1)\n    // 0: Left, 1: Right\n    \n    for (let freqBin = 0; freqBin <= this.shiftSize; freqBin++){\n      power[0][freqBin] = fftCoef[0][2*freqBin]* fftCoef[0][2*freqBin]\n               + fftCoef[0][2*freqBin+1]* fftCoef[0][2*freqBin+1]\n      power[1][freqBin] = fftCoef[1][2*freqBin]* fftCoef[1][2*freqBin]\n               + fftCoef[1][2*freqBin+1]* fftCoef[1][2*freqBin+1]\n    }\n\n    let fftObj = { \n      fftCoef: fftCoef,\n      pan:  [],\n      panAmp: [],\n      power: power,\n      percL: [],\n      percR: []\n    };   \n\n    this.calcPan(fftObj);\n\n    this.fftObjBuffer.push(fftObj);\n\n    return this.calcPerc(this.fftObjBuffer); \n\n  } // end calcFFT\n\n  calcPan (fftObj) {\n\n    const fft = fftObj.fftCoef;\n    let numCoef = fft[0].length/2;\n    let pan = new Float32Array(numCoef);\n    let panAmp = new Float32Array(numCoef);\n\n/*\n  Note: frequency-domain data is stored from dc up to 2pi. \n  so cx_out[0] is the dc bin of the FFT and cx_out[nfft/2] is \n  the Nyquist bin (if exists)\n*/\n\n//    console.log('numCoef', numCoef);\n\n    for(let freqBin = 0; freqBin < numCoef; freqBin++){\n\n      let base = 2*freqBin; \n\n      let innerProd = fft[0][base]*fft[1][base]\n                      + fft[0][base+1]*fft[1][base+1]\n\n      let crossProd = fft[0][base]*fft[1][base+1] // Don't forget minus\n                      - fft[0][base+1]*fft[1][base]\n\n      let abs = Math.sqrt(\n         Math.pow(fft[0][base] + fft[1][base],2)\n       + Math.pow(fft[0][base+1] + fft[1][base+1],2)\n      );\n\n      let absL = Math.sqrt( \n          Math.pow(fft[0][base],2) + Math.pow(fft[0][base+1],2));\n      let absR = Math.sqrt(\n          Math.pow(fft[1][base],2) + Math.pow(fft[1][base+1],2));\n\n      let absLR = Math.sqrt(\n        Math.pow(fft[0][base] - fft[1][base],2)\n        + Math.pow(fft[0][base+1] - fft[1][base+1],2)\n      );\n\n      let frac = 0; \n      if (absL < absR){\n        if (innerProd < 0) {\n          frac = 0;\n          panAmp[freqBin] = (absLR - absL)/abs;\n        } else if (innerProd <= absR*absR) {\n          frac = innerProd/(absR*absR); \n          panAmp[freqBin] = Math.max(absL,absLR) - Math.abs(crossProd)/absR; \n        } else {\n          frac = 1;\n          panAmp[freqBin] = absL - absLR;\n        }\n        pan[freqBin] = (1-frac)/(1+frac);\n        // console.log('bin, fracA', freqBin, frac);\n\n      } else { // absL >= absR\n        if (innerProd < 0) {\n          frac = 0;\n          panAmp[freqBin] = (absLR - absR)/abs;\n        } else if (innerProd <= absL*absL) {\n          frac = innerProd/(absL*absL); \n          panAmp[freqBin] = Math.max(absR,absLR) - Math.abs(crossProd)/absL; \n        } else {\n          frac = 1;\n          panAmp[freqBin] = absR - absLR;\n        }\n        pan[freqBin] = (frac-1)/(1+frac);\n      }\n    // console.log('bin, fracB', freqBin, frac);\n\n       if (isNaN(pan[freqBin])) pan[freqBin] = 0;\n       if (isNaN(panAmp[freqBin])) panAmp[freqBin] = 0;\n\n    } // end for freqBin\n\n    fftObj.pan = pan;\n    fftObj.panAmp = panAmp;\n\n    return;\n  }\n\n\n  calcPerc(fftObjBuffer){\n\n    const median = arr => {\n      const mid = Math.floor(arr.length / 2),\n      nums = [...arr].sort((a, b) => a - b);\n      return arr.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;\n    };\n\n    let buflen = fftObjBuffer.length;\n    // console.log ('buflen', buflen);\n\n    if (buflen < 17) return null; // not enough dat\n\n    let percL = new Float32Array(this.shiftSize+1).fill(0.5); // +1 for DC\n    let percR = new Float32Array(this.shiftSize+1).fill(0.5); \n      // also used as power\n\n    const index = 8;\n    const fftObj = fftObjBuffer[index];\n\n    for (let freqBin = 0; freqBin <= this.shiftSize; freqBin++){\n      let from = Math.max(0, freqBin - 9);\n      let to =  Math.min(freqBin + 9, this.shiftSize + 1); // to (not incl.) \n      let pMedianL = median(fftObj.power[0].slice(from,to));\n      let pMedianR = median(fftObj.power[1].slice(from,to));\n\n      let powerArrayL = [];\n      let powerArrayR = [];\n\n      for (let time = 0; time < buflen; time++){ // buflen (max 17)\n        powerArrayL.push(fftObjBuffer[time].power[0][freqBin]);\n        powerArrayR.length = 0;\n        powerArrayR.push(fftObjBuffer[time].power[1][freqBin]);\n      }\n\n      let hMedianL = median(powerArrayL);\n      let hMedianR = median(powerArrayR);\n\n      percL[freqBin] = (pMedianL*pMedianL)/\n         (pMedianL*pMedianL + hMedianL*hMedianL);\n      if (isNaN(percL[freqBin])) percL[freqBin] = 0.5;\n      percR[freqBin] = (pMedianR*pMedianR)/\n         (pMedianR*pMedianR + hMedianR*hMedianR);\n      if (isNaN(percR[freqBin])) percR[freqBin] = 0.5;\n\n    }\n\n    fftObjBuffer[index].percL = percL;\n    fftObjBuffer[index].percR = percR;\n\n    let retval = { \n      fftCoef: [fftObj.fftCoef[0].slice(), fftObj.fftCoef[1].slice()],\n      pan:  fftObj.pan.slice(),\n      panAmp: fftObj.panAmp.slice(),\n      power: [fftObj.power[0].slice(), fftObj.power[1].slice()],\n      perc: [percL.slice(), percR.slice()]\n    };   \n\n    if (buflen >= 17) fftObjBuffer.splice(0,1);\n\n    return retval;\n  }\n\n  fftFilter (fftObj){\n\n    const fftL = fftObj.fftCoef[0];\n    const fftR = fftObj.fftCoef[1];\n    const percL = fftObj.perc[0];\n    const percR = fftObj.perc[1];\n\n    let outL = fftL.slice();\n    let outR = fftR.slice();\n\n    for (let i = 0; i < this.filterChain.length; i++){\n      let filter = this.filterChain[i];\n      let action = filter.action;\n\n      for (let f = filter.fromFreqIndex; f <= filter.toFreqIndex; f++){\n\n        if (fftObj.pan[f] < filter.fromPan \n          || fftObj.pan[f] > filter.toPan) continue;\n\n        switch (action) {\n          case 'T': // original signal\n            outL[2*f] = fftL[2*f]; outL[2*f+1] = fftL[2*f + 1];\n            outR[2*f] = fftR[2*f]; outR[2*f+1] = fftR[2*f + 1];\n          break;\n\n          case 'M': // mute\n            outL[2*f] = outL[2*f+1] = 0; // real, image\n            outR[2*f] = outR[2*f+1] = 0; // real, image\n          break;\n\n          case 'P':\n            outL[2*f] = fftL[2*f]*percL[f];\n            outL[2*f+1] = fftL[2*f+1]*percL[f];\n            outR[2*f] = fftR[2*f]*percR[f]; \n            outR[2*f+1] = fftR[2*f+1]*percR[f];\n          break;\n          case 'H':\n            outL[2*f] = fftL[2*f]*(1-percL[f]);\n            outL[2*f+1] = fftL[2*f+1]*(1-percL[f]);\n            outR[2*f] = fftR[2*f]*(1-percR[f]); \n            outR[2*f+1] = fftR[2*f+1]*(1-percR[f]);\n          break;\n\n          default:\n            console.log('Filter undef action', action);\n        }\n\n      }\n\n    }\n\n    return [outL, outR];\n  }\n\n}\n\nexport default Effector;\n","import React, {Component} from 'react';\n// import logo from './logo.svg';\nimport './App.css';\nimport packageJSON from '../package.json';\nimport messages from './language.json'; // US and JA message\n// File Saver\nimport * as toWav from 'audiobuffer-to-wav';\nimport {saveAs} from 'file-saver';\n// FFT\n// import {RFFT} from 'fftw-js';\n//import Windowing from 'fft-windowing';\nimport Effector from './effectorClass.js';\n\n// Global variables\nconst version = (packageJSON.homepage + packageJSON.subversion).slice(-11);\nconst jaText = messages.ja;\nconst usText = messages.us;\nvar m = usText; // default\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext\n\nvar audioCtx = null;\n// var offlineCtx = null;\nvar gainNode = null;\nvar effector = null;\n\nvar iOS = false;\nif(  navigator.userAgent.match(/iPhone/i) \n  || navigator.userAgent.match(/iPod/i)\n  || navigator.userAgent.match(/iPad/i)){\n  iOS = true;\n}\n\n\n////////////////////////\nclass App extends Component {\n  constructor (props){\n    super(props);\n\n    this.params = {\n      inputAudio: null,\n      filename: null,\n      currentSource: null,\n      isPlaying: false,\n      effectNode: null,\n      fftShift: 512,\n      filterType: 'bypass',\n      vocalWidth: 0.2\n    }\n\n    this.counter = 0;\n\n    this.state = {\n      ja: false,\n      playingAt: 0, \n      playVolume: 80,\n      startButtonStr: 'loadFile!' // Start/Pause\n    }\n\n    this.loadFile = this.loadFile.bind(this);\n    this.handleLang = this.handleLang.bind(this);\n    this.handleTimeSlider = this.handleTimeSlider.bind(this);\n    this.handleVolumeSlider = this.handleVolumeSlider.bind(this);\n    this.handlePlay = this.handlePlay.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n    this.selectFilter = this.selectFilter.bind(this);\n    this.fakeDownload = this.fakeDownload.bind(this);\n  }\n\n  handleWindowClose(event) { \n    audioCtx.close();\n  }\n\n  componentDidMount () { // after render()\n    audioCtx = new window.AudioContext();\n    gainNode = audioCtx.createGain();\n    window.addEventListener('beforeClosing', this.handleWindowClose);\n  }\n \n    componentWillUnmount () { // before closing app\n    window.removeEventListener('beforeClosing', this.handleWindowClose)\n  }\n\n// GUI \n  render(){\n\n    let duration = 0;\n    if (this.params.inputAudio)\n      duration = this.params.inputAudio.duration;\n\n    let startBStyle = {};\n    if (this.state.startButtonStr === 'Pause') startBStyle = {color: 'green'};\n\n    return(\n      <div className=\"App\">\n       {m.title}\n       <span className='small-button'> &nbsp;&nbsp;\n       <button name='language' onClick={this.handleLang}>\n       {this.state.ja ? 'En(US)' : '日本語'}</button> \n       </span>\n       <hr />\n       Select stereo audio file (from local strage or cloud)<br/>\n       <span className='selectFile'>\n       <input type='file' name='loadFile' \n          accept='audio/*' onChange={this.loadFile} /><br />\n       </span>\n       <hr />\n       <span className='selector'>\n       Filter: &nbsp;\n       <select name='selectFilter' defaultValue='bypass' \n        onChange={this.selectFilter}>\n       <option value='bypass'>bypass</option>\n       <option value='drumCover'>drumCover</option>\n       <option value='karaokeMale'>karaokeMale</option>\n       <option value='karaokeFemale'>karaokeFemale</option>\n       <option value='percussive'>percussive</option>\n       <option value='harmonic'>harmonic</option>\n       <option value='customWithGUI'>customWithGUI</option>\n       </select> \n       &nbsp; vocalWidth: &nbsp;\n       <select name='vocalWidth' defaultValue='0.2' \n        onChange={this.selectFilter}>\n       <option value='0.1'>0.1</option>\n       <option value='0.2'>0.2</option>\n       <option value='0.3'>0.3</option>\n       <option value='0.4'>0.4</option>\n       <option value='0.5'>0.5</option>\n       <option value='0.6'>0.6</option>\n       <option value='0.7'>0.7</option>\n       </select>\n       </span>\n       <hr />\n       Time: {this.state.playingAt.toFixed(2)} <br />\n        <span className='slider'> \n        <center>\n        000 <input type='range' name='timeSlider' min='0' max={duration}\n        value = {this.state.playingAt} step='1'\n        onChange={this.handleTimeSlider} /> &nbsp;\n        {Math.round(duration)}<br />\n        </center>\n        </span>\n       <hr />\n        Vol: {this.state.playVolume} <br />\n        <span className='slider'> \n         <center>\n         000 <input type='range' name='volumeSlider' min='0' max='150'\n         value = {this.state.playVolume} \n           onChange={this.handleVolumeSlider} /> 150<br />\n         </center>\n        </span>\n       <hr />\n       <span>\n       <button name='startPause' onClick={this.handlePlay} \n          style={startBStyle}>{this.state.startButtonStr}\n       </button> &nbsp;&nbsp;\n       <button name='rewind' onClick={this.handlePlay}>Rewind</button>\n       </span>\n       <hr />\n        Version: {version}, &nbsp;\n        <a href={m.homepage} \n         target=\"_blank\" rel=\"noopener noreferrer\">{m.guide}</a>\n      </div>\n    );\n  } // end render()\n\n// event handlers\n  loadFile (e) {\n    if (e.target.name !== 'loadFile') return;\n    if (e.target.files.length === 0) return;\n    if (this.params.isPlaying) return;\n\n    let file = e.target.files[0]; \n    this.params.filename = file.name;\n \n    let reader = new FileReader();\n    reader.onload = function(e) {\n      audioCtx.decodeAudioData(reader.result, \n        function(audioBuffer) {\n          this.params.inputAudio = audioBuffer;\n          this.setState({playingAt: 0});\n          this.setState({startButtonStr: 'Play'});\n        }.bind(this),\n          function (error) { console.log (\"Filereader error: \" + error.err) \n        }\n      );\n\n    }.bind(this);\n\n    reader.readAsArrayBuffer(file);\n\n  }\n\n  handleLang(e){\n    if (e.target.name !== 'language') return;\n\n    if (this.state.ja) {\n      m = usText; this.setState({ja: false}); \n    } else {\n      m = jaText; this.setState({ja: true}); \n    }\n  }\n\n  handleVolumeSlider(e){\n    if (e.target.name !== 'volumeSlider') return;\n\n    let vol = parseInt(e.target.value);\n    gainNode.gain.value = vol/100.0;\n    this.setState({playVolume: vol});\n    return;\n  }\n\n  handleTimeSlider(e){\n    if (this.params.isPlaying) return;\n\n    if (e.target.name !== 'timeSlider') return;\n\n    this.setState({playingAt: parseFloat(e.target.value)});\n  }\n\n  handlePlay(e){\n        let source = null;\n\n   if (e.target.name === 'startPause') {\n\n     if (this.state.startButtonStr === 'Play'){\n\n       if (this.params.isPlaying \n          || this.params.inputAudio.numberOfChannels !== 2) return;\n\n       this.params.isPlaying = true;\n\n// unlock iOS\n       if(iOS) {\n         let buffer = audioCtx.createBuffer(1,1,44100); \n         source = audioCtx.createBufferSource();\n         source.buffer = buffer;\n         source.connect (audioCtx.destination);\n         source.start();\n       } \n// End unlock iOS\n\n// Playing\n       source = audioCtx.createBufferSource();\n       this.params.currentSource = source;\n\n       // add 0.5 sec (sampleRate/2) at the beginning and the end\n       let original = this.params.inputAudio;\n       let modified = audioCtx.createBuffer(\n           original.numberOfChannels, \n           original.length + original.sampleRate,\n           original.sampleRate\n       ); \n\n       for (let channel = 0; channel < modified.numberOfChannels; channel++){\n         let from = original.getChannelData(channel);\n         let to = modified.getChannelData(channel);\n         for (let sample = 0; sample < modified.sampleRate/2; sample++) \n            to[sample] = 0;\n         for (let sample = modified.sampleRate/2; \n            sample < original.length; sample++) \n            to[sample] = from[sample - modified.sampleRate/2];\n         for (let sample = original.length; sample < modified.length; sample++)\n            to[sample] = 0; \n       }\n\n       source.buffer = modified;\n\n// Create effectNode\n       effector = new Effector(audioCtx, this.params.fftShift, modified);\n       let effectNode;\n       let channels = this.params.inputAudio.numberOfChannels;\n       let bufferSize = this.params.fftShift; // 1024 window half step\n\n       if (audioCtx.createJavaScriptNode) {\n          effectNode \n           = audioCtx.createJavaScriptNode(bufferSize,channels,channels);\n          console.log ('createJavaScriptNode');\n       } else if (audioCtx.createScriptProcessor) {\n         effectNode = audioCtx.createScriptProcessor(bufferSize, \n          channels,channels);\n          console.log ('createScriptProcessor');\n        } // end if audioCtx\n        this.params.effectNode = effectNode;\n\n\n// Connect\n        source.connect(effectNode)\n        effectNode.connect(gainNode);\n        gainNode.connect(audioCtx.destination);\n        source.start(0,this.state.playingAt);\n\n// test filters (GUI)\n//        effector.addFilter(-1,0,1,40000,'M');\n//        effector.addFilter(-0.2,300,0.2,40000,'M');\n//        effector.addFilter(-1,0,1,40000,'P');\n//        effector.addFilter(-1,0,1,40000,'H');\n//        effector.presetFilter('karaokeMale');\n//        effector.presetFilter('drumCover');\n//        effector.presetFilter('percussive');\n//        effector.presetFilter('harmonic');\n//        effector.presetFilter('bypass');\n\n        effectNode.onaudioprocess = function(e) {\n\n          let inputBuffer = e.inputBuffer;\n          let outputBuffer = e.outputBuffer;\n\n//          effector.copy(inputBuffer, outputBuffer); // for test\n          effector.process(inputBuffer, outputBuffer);\n\n          if (this.state.playingAt*inputBuffer.sampleRate >= modified.length){\n            source.stop();\n            effectNode.disconnect();\n            effectNode.onaudioprocess = null;\n            effector = null;\n          }\n\n          this.counter++;\n          let update = 20;\n          if (this.counter % update === 0) { \n             this.setState({playingAt: this.state.playingAt \n             + (update*inputBuffer.length)/inputBuffer.sampleRate});\n          }\n\n\n          return; \n        }.bind(this) // end onaudioprocess function(e)\n\n        this.setState({startButtonStr: 'Pause'});\n\n        return;\n      } // end Play\n\n      if (this.state.startButtonStr === 'Pause'){\n\n        if (!this.params.isPlaying) return;\n\n        this.params.currentSource.disconnect();\n        this.params.effectNode.disconnect();\n        this.params.effectNode.onaudioprrocess = null;\n        gainNode.disconnect();\n        this.params.currentSource.stop();\n        this.setState({startButtonStr: 'Play'});\n        this.params.isPlaying = false;\n\n        return;\n      } // end Pause\n\n    } // end startPause\n\n    if (e.target.name === 'rewind') {\n      if (this.params.isPlaying) return;\n      this.setState({playingAt: 0});\n      return;\n    }\n\n  } // end handlePlay()\n\n  selectFilter(e){\n\n    if (e.target.name === 'selectFilter' && effector !== null) {\n\n      switch(e.target.value){\n        case 'drumCover': \n        case 'karaokeMale': \n        case 'karaokeFemale': \n          effector.presetFilter(e.target.value, this.params.vocalWidth);\n        break;\n        case 'percussive': case 'harmonic':\n          effector.presetFilter(e.target.value, 0);\n        break;\n        case 'bypass': \n        case 'customWithGUI': \n          effector.presetFilter('bypass', 0);\n        break; // customWithGUI not implemented\n        default:\n      }\n      this.params.filterType = e.target.value;\n    } \n\n    if (e.target.name === 'vocalWidth' \n       && effector !== null && this.params.filterType !== null) {\n       this.params.vocalWidth = parseFloat(e.target.value);\n       effector.presetFilter(this.params.filterType, this.params.vocalWidth);\n    }\n\n  }\n\n  handleSave(e){ // offline processing (may work for this)\n  } // end handleSave\n\n  fakeDownload(audioBuffer){\n\n    const words = this.params.filename.split('.');\n    let outFileName = \n         words[0]\n       + '&s' + parseInt(this.state.playSpeed)\n       + '&p' + parseInt(this.state.playPitch*100)\n       + '.wav';\n    let blob = new Blob([toWav(audioBuffer)], {type: 'audio/vnd.wav'});\n    saveAs(blob,outFileName);\n\n  } // end fakeDownload\n \n} // end class\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}