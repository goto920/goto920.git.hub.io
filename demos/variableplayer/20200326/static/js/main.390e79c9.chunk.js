(this.webpackJsonpvariablespeedplayer=this.webpackJsonpvariablespeedplayer||[]).push([[0],{13:function(e,t,a){e.exports=a(21)},18:function(e,t,a){},19:function(e,t,a){},21:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(5),i=a.n(l),o=(a(18),a(6)),s=a(7),c=a(11),h=a(8),p=a(1),u=a(12),d=(a(19),a(2)),m=a(3),f=a(9),v=a(10),S=(m.homepage+m.subversion).slice(-10);window.AudioContext=window.AudioContext||window.webkitAudioContext;window.setTimeout;var y,g,b=window.setInterval;window.setInterval=function(e,t){var a=this,n=Array.prototype.slice.call(arguments,2);return b(e instanceof Function?function(){e.apply(a,n)}:e,t)};var B=null,A=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).params={filename:void 0,audioBuffer:void 0,loop:!1,exportDataL:void 0,exportDataR:void 0,exportBuffer:void 0,save:!1},a.state={playingAt:0,timeA:0,timeB:0,playSpeed:100,playPitch:0,playPitchSemi:0,playPitchCents:0,playVolume:80,startButtonStr:"loadFile!",loopButtonStr:"LoopAB",saveButtonStr:"Save"},a.setState=a.setState.bind(Object(p.a)(a)),a.handleWindowClose=a.handleWindowClose.bind(Object(p.a)(a)),a.loadFile=a.loadFile.bind(Object(p.a)(a)),a.fetchFile=a.fetchFile.bind(Object(p.a)(a)),a.fetchFileB=a.fetchFileB.bind(Object(p.a)(a)),a.handleSpeedSlider=a.handleSpeedSlider.bind(Object(p.a)(a)),a.handlePitchSlider=a.handlePitchSlider.bind(Object(p.a)(a)),a.handleTimeSlider=a.handleTimeSlider.bind(Object(p.a)(a)),a.handleVolumeSlider=a.handleVolumeSlider.bind(Object(p.a)(a)),a.handlePlay=a.handlePlay.bind(Object(p.a)(a)),a.handleSaveA=a.handleSaveA.bind(Object(p.a)(a)),a.handleSaveB=a.handleSaveB.bind(Object(p.a)(a)),a.fakeDownload=a.fakeDownload.bind(Object(p.a)(a)),a.timer=a.timer.bind(Object(p.a)(a)),a.handleLoop=a.handleLoop.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(s.a)(t,[{key:"handleWindowClose",value:function(e){y.close()}},{key:"componentDidMount",value:function(){y=new window.AudioContext,g=y.createGain(),window.addEventListener("beforeClosing",this.handleWindowClose)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeClosing",this.handleWindowClose),clearInterval(this.state.intervalId)}},{key:"timer",value:function(){null!==B&&(this.setState({playingAt:parseFloat(this.state.timeA)+parseFloat(B.timePlayed)}),100===B.percentagePlayed&&(this.params.loop?this.handlePlay({target:{name:"LoopAB"}}):(clearInterval(this.state.intervalId),this.params.save&&(this.params.exportBuffer.copyToChannel(this.params.exportDataL,0,0),this.params.exportBuffer.copyToChannel(this.params.exportDataR,1,0),this.fakeDownload(this.params.exportBuffer),this.params.save=!1,this.setState({saveButtonStr:"Save"})))))}},{key:"render",value:function(){var e=this.loadFile,t=(this.fetchFile,this.fetchFileB,this.handleSpeedSlider),a=this.handlePitchSlider,n=this.handleVolumeSlider,l=this.handleTimeSlider,i=this.handlePlay,o=(this.handleSaveA,this.handleSaveB),s=this.handleLoop,c=this.state,h=c.playingAt,p=c.timeA,u=c.timeB,d=c.playSpeed,m=c.playPitch,f=c.playPitchSemi,v=c.playPitchCents,y=c.playVolume,g=c.startButtonStr,b=c.loopButtonStr,B=c.saveButtonStr,A=0;return void 0!==this.params.audioBuffer&&(A=this.params.audioBuffer.duration),r.a.createElement("div",{className:"App"},"Variable speed/pitch audio player",r.a.createElement("br",null),"with soundtouchjs by KG",r.a.createElement("hr",null),"Input Audio (local file): ",r.a.createElement("br",null),r.a.createElement("span",{className:"selectFile"},r.a.createElement("input",{type:"file",name:"loadFile",accept:"audio/*",onChange:e}),r.a.createElement("br",null)),r.a.createElement("hr",null),"Speed(%): ",d," ",r.a.createElement("br",null),r.a.createElement("span",{className:"slider"},r.a.createElement("center",null,"025",r.a.createElement("input",{type:"range",name:"speedSlider",min:"25",max:"200",value:d,onChange:t}),"200")),r.a.createElement("hr",null),"Pitch (semi-tone): ",m," ",r.a.createElement("br",null),r.a.createElement("span",{className:"slider"},r.a.createElement("center",null,"-12",r.a.createElement("input",{type:"range",name:"pitchSliderSemi",min:"-12",max:"12",value:f,onChange:a}),"12",r.a.createElement("br",null),"-100",r.a.createElement("input",{type:"range",name:"pitchSliderCents",min:"-100",max:"100",value:v,onChange:a}),"100",r.a.createElement("br",null))),r.a.createElement("hr",null),"Time: ",Math.round(h),r.a.createElement("br",null),r.a.createElement("span",{className:"slider"},r.a.createElement("center",null,"0",r.a.createElement("input",{type:"range",name:"timeSlider",min:"0",max:A,value:h,step:"1",onChange:l}),Math.round(A),r.a.createElement("br",null)),r.a.createElement("button",{name:"setA",onClick:s},"setA"),": ",Math.round(10*p)/10," \xa0\xa0",r.a.createElement("button",{name:"setB",onClick:s},"setB"),": ",Math.round(10*u)/10),r.a.createElement("hr",null),"Volume: ",y,r.a.createElement("br",null),r.a.createElement("span",{className:"slider"},r.a.createElement("center",null,"0",r.a.createElement("input",{type:"range",name:"volumeSlider",min:"0",max:"150",value:y,onChange:n}),"150",r.a.createElement("br",null))),r.a.createElement("hr",null),r.a.createElement("span",null,r.a.createElement("button",{name:"startPause",onClick:i},g)," \xa0\xa0",r.a.createElement("button",{name:"LoopAB",onClick:s},b)," \xa0\xa0",r.a.createElement("button",{name:"reset",onClick:i},"ResetAB")," ",r.a.createElement("hr",null),r.a.createElement("button",{name:"save",onClick:o},B)),r.a.createElement("hr",null),"Version: ",S,", \xa0",r.a.createElement("a",{href:"https://goto920.github.io/demos/variableplayer/",target:"_blank",rel:"noopener noreferrer"},"Manual/Update"))}},{key:"loadFile",value:function(e){if("loadFile"===e.target.name&&0!==e.target.files.length){this.setState({totalTime:0}),this.setState({startButtonStr:"loadFile!"});var t=e.target.files[0];this.params.filename=t.name;var a=new FileReader;a.onload=function(e){y.decodeAudioData(a.result,function(e){this.params.audioBuffer=e,this.setState({startButtonStr:"PlayFromA",playingAt:0}),this.setState({timeA:0}),this.setState({timeB:e.duration})}.bind(this),(function(e){console.log("Filereader error: "+e.err)}))}.bind(this),a.readAsArrayBuffer(t)}}},{key:"fetchFileB",value:function(e){if("fetchFile"===e.target.name&&13===(e.keyCode||e.charCode)){console.log("Got enter");var t=e.target.value;this.setState({startButtonStr:"Loading..."}),B&&B.off(),console.log("fetchFile: "+t);var a=new XMLHttpRequest;a.open("GET",t),a.responseType="arraybuffer",a.onload=function(){console.log("Loaded:",a.status),console.log(a.getResponsHeader("Content-Type")),console.log(a.getResponsHeader("Content-Length"))},a.send()}}},{key:"fetchFile",value:function(e){if("fetchFile"===e.target.name&&13===(e.keyCode||e.charCode)){console.log("Got enter");var t=e.target.value;this.setState({startButtonStr:"loadFile!"}),B&&B.off(),console.log("fetchFile: "+t),fetch(t,{method:"GET",mode:"cors",redirect:"follow"}).then((function(e){return console.log(e.headers),e})).catch((function(e){return console.log(e)}))}}},{key:"handleSpeedSlider",value:function(e){"speedSlider"===e.target.name&&(B&&(B.tempo=e.target.value/100),this.setState({playSpeed:e.target.value}))}},{key:"handlePitchSlider",value:function(e){var t;"pitchSliderSemi"===e.target.name&&(t=1*e.target.value+this.state.playPitchCents/100,this.setState({playPitchSemi:e.target.value})),"pitchSliderCents"===e.target.name&&(t=1*this.state.playPitchSemi+e.target.value/100,this.setState({playPitchCents:e.target.value})),B&&(B.pitch=Math.pow(2,t/12)),this.setState({playPitch:t})}},{key:"handleTimeSlider",value:function(e){"timeSlider"===e.target.name&&"PlayFromA"===this.state.startButtonStr&&this.setState({playingAt:e.target.value})}},{key:"handleVolumeSlider",value:function(e){if("volumeSlider"===e.target.name){var t=1*e.target.value;g.gain.value=t/100,this.setState({playVolume:t})}}},{key:"handlePlay",value:function(e){var t=this.params.audioBuffer,a=y.createBuffer(1,1,44100),n=y.createBufferSource();n.buffer=a,n.connect(y.destination),n.start();var r=this.state.timeB,l=this.state.timeA;if("LoopAB"===e.target.name){r<=l&&(r=l+10);var i=y.createBuffer(2,(r-l)*t.sampleRate,t.sampleRate),o=t.getChannelData(0),s=t.getChannelData(1);o=o.subarray(l*t.sampleRate,r*t.sampleRate),i.copyToChannel(o,0,0),2===t.numberOfChannels&&(s=s.subarray(l*t.sampleRate,r*t.sampleRate),i.copyToChannel(s,1,0)),(B=new d.a(y,i,4096)).tempo=this.state.playSpeed/100,B.pitch=Math.pow(2,this.state.playPitch/12),B.connect(g),g.connect(y.destination);var c=setInterval(this.timer,1e3);this.setState({intervalId:c})}if("startPause"===e.target.name){if("Pause"===this.state.startButtonStr){if(this.setState({timeA:this.state.playingAt}),clearInterval(this.state.intervalId),null===B)return;this.setState({PlayingAt:parseFloat(l)+parseFloat(B.timePlayed)}),B.disconnect(),B.off(),B=null,this.setState({startButtonStr:"PlayFromA"})}if("PlayFromA"===this.state.startButtonStr){if("LoopAB"!==this.state.loopButtonStr)return;var h=y.createBuffer(2,(t.duration-this.state.timeA)*t.sampleRate,t.sampleRate),p=t.getChannelData(0),u=t.getChannelData(1);p=p.subarray(this.state.timeA*t.sampleRate,t.duration*t.sampleRate),h.copyToChannel(p,0,0),2===t.numberOfChannels&&(u=u.subarray(this.state.timeA*t.sampleRate,t.duration*t.sampleRate),h.copyToChannel(u,1,0)),(B=new d.a(y,h,4096)).tempo=this.state.playSpeed/100,B.pitch=Math.pow(2,this.state.playPitch/12),B.connect(g),g.connect(y.destination);var m=setInterval(this.timer,1e3);this.setState({intervalId:m}),this.setState({startButtonStr:"Pause"})}}if("reset"===e.target.name){if("PlayFromA"!==this.state.startButtonStr&&"LoopAB"!==this.state.loopButtonStr)return;B&&(B.disconnect(),B.off(),B=null,clearInterval(this.state.intervalId)),this.setState({startButtonStr:"PlayFromA",playingAt:0,timeA:0,timeB:t.duration})}}},{key:"handleSaveA",value:function(e){var t=this.params.audioBuffer;if("PlayFromA"===this.state.startButtonStr&&"LoopAB"===this.state.loopButtonStr){console.log("handleSaveA");var a=new OfflineAudioContext(t.numberOfChannels,parseInt(t.length*(100/this.state.playSpeed)),t.sampleRate);(B=new d.a(a,t,512)).tempo=this.state.playSpeed/100,B.pitch=Math.pow(2,this.state.playPitch/12),B.connect(a.destination),a.startRendering(),a.oncomplete=function(e){console.log("offline rendering complete:",e.renderedBuffer);var t=y.createBufferSource();t.buffer=e.renderedBuffer,t.connect(y.destination),t.start()}.bind(this)}}},{key:"fakeDownload",value:function(e){var t=this.params.filename.split(".")[0]+"&s"+parseInt(this.state.playSpeed)+"&p"+parseInt(100*this.state.playPitch)+".wav",a=new Blob([v(e)],{type:"audio/wav"});Object(f.saveAs)(a,t),console.log("Output ",t)}},{key:"handleSaveB",value:function(e){var t=this.params.audioBuffer;if("PlayFromA"===this.state.startButtonStr&&"LoopAB"===this.state.loopButtonStr&&!this.params.save){console.log("handleSaveB");var a=null,n=t.numberOfChannels;if((B=new d.a(y,t,4096)).tempo=this.state.playSpeed/100,B.pitch=Math.pow(2,this.state.playPitch/12),y.createJavaScriptNode)a=y.createJavaScriptNode(4096,n,n);else{if(!y.createScriptProcessor)return void console.log("createScript is not supported");a=y.createScriptProcessor(4096,n,n)}this.params.exportBuffer=y.createBuffer(n,parseInt(t.length*(100/this.state.playSpeed)),t.sampleRate),this.params.exportDataL=new Float32Array(this.params.exportBuffer.length),this.params.exportDataR=new Float32Array(this.params.exportBuffer.length),this.params.save=!0;var r=0;a.onaudioprocess=function(e){for(var t=e.inputBuffer,a=e.outputBuffer,n=0;n<t.numberOfChannels;n++)for(var l=t.getChannelData(n),i=a.getChannelData(n),o=0;o<t.length;o++)i[o]=l[o],0===n?this.params.exportDataL[r+o]=l[o]:this.params.exportDataR[r+o]=l[o];r+=t.length}.bind(this),B.connect(a),a.connect(g),g.connect(y.destination);var l=setInterval(this.timer,1e3);this.setState({intervalId:l,saveButtonStr:"Please Wait!"})}}},{key:"handleLoop",value:function(e){if("setA"===e.target.name&&this.setState({timeA:this.state.playingAt}),"setB"===e.target.name&&(this.state.playingAt>=this.state.timeA?this.setState({timeB:parseFloat(this.state.playingAt)}):this.setState({timeB:parseFloat(this.state.timeA)+parseFloat(10)})),"LoopAB"===e.target.name)if("LoopAB"===this.state.loopButtonStr){if("PlayFromA"!==this.state.startButtonStr)return;B&&(B.disconnect(),B.off()),this.setState({loopButtonStr:"StopLoop"}),this.params.loop=!0,this.handlePlay({target:{name:"LoopAB"}})}else"StopLoop"===this.state.loopButtonStr&&(B&&(B.disconnect(),B.off()),clearInterval(this.state.intervalId),this.params.loop=!1,this.setState({loopButtonStr:"LoopAB"}))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},3:function(e){e.exports=JSON.parse('{"name":"variablespeedplayer","version":"0.1.0","private":true,"homepage":"/demos/variableplayer/20200326","subversion":"00","dependencies":{"audiobuffer-to-wav":"^1.0.0","file-saver":"^2.0.2","react":"^16.13.1","react-dom":"^16.13.1","react-scripts":"3.3.1","soundtouchjs":"^0.1.10","whatwg-fetch":"^3.0.0"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')}},[[13,1,2]]]);
//# sourceMappingURL=main.390e79c9.chunk.js.map