(this.webpackJsonpvariablespeedplayer=this.webpackJsonpvariablespeedplayer||[]).push([[0],{14:function(e,t,a){e.exports=a(22)},19:function(e,t,a){},20:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var n,r,i=a(0),l=a.n(i),o=a(6),s=a.n(o),p=(a(19),a(7)),u=a(8),c=a(12),h=a(9),d=a(1),m=a(13),f=(a(20),a(2)),S=a(3),v=a(10),g=a(11),y=a(4),B=(S.homepage+S.subversion).slice(-11),b=y.ja,A=y.us,E=A;window.AudioContext=window.AudioContext||window.webkitAudioContext;var P=null,C=!1;(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))&&(C=!0);var w=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(c.a)(this,Object(h.a)(t).call(this,e))).params={filename:null,audioBuffer:null,isPlaying:!1,loop:!1,loopInterval:2,exportDataL:null,exportDataR:null,exportBuffer:null,save:!1},a.state={ja:!1,playingAt:0,playingAtSlider:0,timeA:0,timeB:0,playSpeed:100,playPitch:0,playPitchSemi:0,playPitchCents:0,playVolume:80,startButtonStr:E.loadFile,loopButtonStr:E.loopAB,saveButtonStr:E.exportWav},a.setState=a.setState.bind(Object(d.a)(a)),a.handleWindowClose=a.handleWindowClose.bind(Object(d.a)(a)),a.loadFile=a.loadFile.bind(Object(d.a)(a)),a.handleSpeedSlider=a.handleSpeedSlider.bind(Object(d.a)(a)),a.handlePitchSlider=a.handlePitchSlider.bind(Object(d.a)(a)),a.handleTimeSlider=a.handleTimeSlider.bind(Object(d.a)(a)),a.handleVolumeSlider=a.handleVolumeSlider.bind(Object(d.a)(a)),a.handlePlay=a.handlePlay.bind(Object(d.a)(a)),a.handleSaveB=a.handleSaveB.bind(Object(d.a)(a)),a.fakeDownload=a.fakeDownload.bind(Object(d.a)(a)),a.handleLoop=a.handleLoop.bind(Object(d.a)(a)),a.playAB=a.playAB.bind(Object(d.a)(a)),a.handleLang=a.handleLang.bind(Object(d.a)(a)),a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleWindowClose",value:function(e){P&&(P.disconnect(),P.off(),P=null),n.close()}},{key:"componentDidMount",value:function(){n=new window.AudioContext,r=n.createGain(),window.addEventListener("beforeClosing",this.handleWindowClose)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeClosing",this.handleWindowClose)}},{key:"render",value:function(){var e,t,a,n=this.loadFile,r=this.handleSpeedSlider,i=this.handlePitchSlider,o=this.handleVolumeSlider,s=this.handleTimeSlider,p=this.handlePlay,u=this.handleSaveB,c=this.handleLoop,h=this.handleLang,d=this.state,m=d.ja,f=d.playingAt,S=d.playingAtSlider,v=d.timeA,g=d.timeB,y=d.playSpeed,b=d.playPitch,A=d.playPitchSemi,P=d.playPitchCents,C=d.playVolume,w=d.startButtonStr,x=d.loopButtonStr,O=d.saveButtonStr,k=0;this.params.audioBuffer&&(k=this.params.audioBuffer.duration),e=w===E.pause?{color:"green"}:{},t=x===E.stopLoop?{color:"green"}:{},a=O===E.abortExport?{color:"green"}:{};var F={border:"1px dotted",color:"blue"};return l.a.createElement("div",{className:"App"},E.title," \xa0\xa0",l.a.createElement("span",{className:"small-button"},l.a.createElement("button",{name:"language",onClick:h},m?"En(US)":"\u65e5\u672c\u8a9e")),l.a.createElement("hr",null),"1) ",E.input,": ",l.a.createElement("br",null),l.a.createElement("span",{className:"selectFile"},l.a.createElement("input",{type:"file",name:"loadFile",accept:"audio/*",onChange:n}),l.a.createElement("br",null)),l.a.createElement("hr",null),E.speed,": ",y," \xa0\xa0",l.a.createElement("button",{name:"reset",onClick:r},E.reset),l.a.createElement("br",null),l.a.createElement("span",{className:"slider"},l.a.createElement("center",null,"025",l.a.createElement("input",{type:"range",name:"speedSlider",min:"25",max:"200",value:y,onChange:r}),"200")),l.a.createElement("hr",null),E.pitch,": ",parseFloat(b).toFixed(2)," \xa0\xa0",l.a.createElement("button",{name:"reset",onClick:i},E.reset),l.a.createElement("br",null),l.a.createElement("span",{className:"slider"},l.a.createElement("center",null,"-12",l.a.createElement("input",{type:"range",name:"pitchSliderSemi",min:"-12",max:"12",value:A,onChange:i}),"12",l.a.createElement("br",null),l.a.createElement("hr",{style:F}),"-100",l.a.createElement("input",{type:"range",name:"pitchSliderCents",min:"-100",max:"100",value:P,onChange:i}),"100",l.a.createElement("br",null))),l.a.createElement("hr",null),E.time,": ",f.toFixed(2)," \xa0 ",E.timeNote,l.a.createElement("br",null),l.a.createElement("span",{className:"slider"},l.a.createElement("center",null,"0",l.a.createElement("input",{type:"range",name:"timeSlider",min:"0",max:k,value:S,step:"1",onChange:s}),Math.round(k),l.a.createElement("br",null)),l.a.createElement("button",{name:"setA",onClick:c},E.setA),": ",v.toFixed(2)," \xa0\xa0",l.a.createElement("button",{name:"setB",onClick:c},E.setB),": ",g.toFixed(2)," \xa0\xa0",l.a.createElement("button",{name:"resetAB",onClick:c},E.resetAB)),l.a.createElement("hr",null),E.volume,": ",C," \xa0\xa0 ",E.volumeNote,l.a.createElement("br",null),l.a.createElement("span",{className:"slider"},l.a.createElement("center",null,"0",l.a.createElement("input",{type:"range",name:"volumeSlider",min:"0",max:"150",value:C,onChange:o}),"150",l.a.createElement("br",null))),l.a.createElement("hr",null),l.a.createElement("span",null,"2A) ",l.a.createElement("button",{name:"startPause",onClick:p,style:e},w)," \xa0\xa0",l.a.createElement("button",{name:"Rewind",onClick:c},E.rewind),l.a.createElement("hr",{style:F}),"2B) ",l.a.createElement("button",{name:"LoopAB",onClick:c,style:t},x)," \xa0\xa0",E.interval," ",l.a.createElement("span",{className:"selector"},l.a.createElement("select",{name:"loopInterval",defaultValue:this.params.loopInterval,onChange:c},l.a.createElement("option",{value:"0"},"00"),l.a.createElement("option",{value:"1"},"01"),l.a.createElement("option",{value:"2"},"02"),l.a.createElement("option",{value:"4"},"04"),l.a.createElement("option",{value:"5"},"05"),l.a.createElement("option",{value:"10"},"10"),l.a.createElement("option",{value:"20"},"20"),l.a.createElement("option",{value:"30"},"30"),l.a.createElement("option",{value:"60"},"60"))),l.a.createElement("hr",null),"3) ",l.a.createElement("button",{name:"save",onClick:u,style:a},O)," \xa0|\xa0",l.a.createElement("button",{name:"resetContext",onClick:p},E.resetAudio)),l.a.createElement("hr",null),E.version,": ",B,", \xa0",l.a.createElement("a",{href:E.homepage,target:"_blank",rel:"noopener noreferrer"},E.guide),l.a.createElement("br",null),"Based on ",l.a.createElement("a",{href:"https://github.com/cutterbl/SoundTouchJS",target:"_blank",rel:"noopener noreferrer"},"cutterbl/SoundTouchJS"))}},{key:"loadFile",value:function(e){if("loadFile"===e.target.name&&0!==e.target.files.length&&!this.params.isPlaying){this.setState({totalTime:0}),this.setState({startButtonStr:E.playOnce});var t=e.target.files[0];this.params.filename=t.name;var a=new FileReader;a.onload=function(e){n.decodeAudioData(a.result,function(e){this.params.audioBuffer=e,this.setState({startButtonStr:E.playOnce,playingAt:0,playingAtSlider:0}),this.setState({timeA:0}),this.setState({timeB:e.duration})}.bind(this),(function(e){console.log("Filereader error: "+e.err)})),this.handlePlay({target:{name:E.resetAudio}})}.bind(this),a.readAsArrayBuffer(t)}}},{key:"handleSpeedSlider",value:function(e){if("speedSlider"===e.target.name)return P&&(P.tempo=e.target.value/100),void this.setState({playSpeed:e.target.value});"reset"!==e.target.name||this.setState({playSpeed:100})}},{key:"handlePitchSlider",value:function(e){var t=0;"pitchSliderSemi"===e.target.name?(t=parseFloat(e.target.value)+parseFloat(this.state.playPitchCents)/100,this.setState({playPitchSemi:e.target.value})):"pitchSliderCents"===e.target.name?(t=parseFloat(this.state.playPitchSemi)+parseFloat(e.target.value)/100,this.setState({playPitchCents:e.target.value})):"reset"===e.target.name&&(this.setState({playPitchSemi:0,playPitchCents:0}),t=0),P&&(P.pitch=Math.pow(2,t/12)),this.setState({playPitch:t})}},{key:"handleTimeSlider",value:function(e){if("timeSlider"===e.target.name&&this.state.startButtonStr===E.playOnce){var t=e.target.value;this.setState({playingAt:parseFloat(t)}),this.setState({playingAtSlider:t})}}},{key:"handleVolumeSlider",value:function(e){if("volumeSlider"===e.target.name){var t=1*e.target.value;r.gain.value=t/100,this.setState({playVolume:t})}}},{key:"handlePlay",value:function(e){var t=this.params.audioBuffer;if("startPause"===e.target.name){var a,n;if(this.state.startButtonStr===E.pause){if(!this.params.isPlaying)return;if(null===P)return;return P.disconnect(),P.off(),P=null,this.params.isPlaying=!1,this.setState({playingAtSlider:this.state.playingAt}),void this.setState({startButtonStr:E.playOnce})}if("startPause"===e.target.name&&this.state.startButtonStr===E.playOnce){if(this.params.isPlaying)return;return a=this.state.playingAt,n=t.duration,void this.playAB(a,n)}}}},{key:"fakeDownload",value:function(e){var t=this.params.filename.split(".")[0]+"&s"+parseInt(this.state.playSpeed)+"&p"+parseInt(100*this.state.playPitch)+".wav",a=new Blob([g(e)],{type:"audio/vnd.wav"});Object(v.saveAs)(a,t)}},{key:"handleSaveB",value:function(e){var t=this;if("save"===e.target.name&&this.state.startButtonStr===E.playOnce&&this.state.loopButtonStr===E.loopAB){var a=this.params.audioBuffer;if(this.state.saveButtonStr===E.abortExport){if(P&&(P.disconnect(),P.off(),P=null),C){n.close(),n=new window.AudioContext,r=n.createGain();var i=n.createBuffer(1,1,44100),l=n.createBufferSource();l.buffer=i,l.connect(n.destination),l.start()}return this.params.isPlaying=!1,void this.setState({saveButtonStr:E.exportWav})}if(this.state.saveButtonStr===E.exportWav){if(this.params.isPlaying)return;if(!a)return;var o=null,s=a.numberOfChannels;P&&(P.disconnect(),P.off(),P=null);if((P=new f.a(n,a,8192)).tempo=this.state.playSpeed/100,P.pitch=Math.pow(2,this.state.playPitch/12),n.createJavaScriptNode)o=n.createJavaScriptNode(8192,s,s),console.log("createJavaScriptNode");else{if(!n.createScriptProcessor)return void console.log("createScript is not supported");o=n.createScriptProcessor(8192,s,s),console.log("createScriptProcessor")}this.params.exportBuffer=n.createBuffer(s,parseInt(a.length*(100/this.state.playSpeed))+8192,a.sampleRate),this.params.save=!0;var p=0;return AudioBuffer.prototype.copyToChannel?console.log("copyToChannel OK"):console.log("copyToChannel NG"),o.onaudioprocess=function(e){for(var t=e.inputBuffer,a=e.outputBuffer,n=this.params.exportBuffer,r=0;r<t.numberOfChannels;r++){var i=t.getChannelData(r);a.getChannelData(r),n.getChannelData(r);AudioBuffer.prototype.copyToChannel&&(a.copyToChannel(i,r,0),n.copyToChannel(i,r,p))}p+=t.length}.bind(this),P.on("play",(function(e){var a=parseFloat(e.timePlayed);if(t.setState({playingAt:a}),t.setState({playingAtSlider:a}),e.formattedTimePlayed>=P.formattedDuration)return o.disconnect(),P.off(),P.disconnect(),P=null,C||t.fakeDownload(t.params.exportBuffer),t.params.isPlaying=!1,t.setState({saveButtonStr:E.exportWav}),void(t.params.save=!1)})),this.setState({saveButtonStr:E.abortExport}),this.params.isPlaying=!0,P.connect(o),o.connect(r),r.connect(n.destination),void n.resume()}}}},{key:"handleLoop",value:function(e){if("loopInterval"!==e.target.name){if("Rewind"===e.target.name){if(this.params.isPlaying)return;return this.setState({playingAt:0}),void this.setState({playingAtSlider:0})}if("setA"===e.target.name)return this.setState({timeA:this.state.playingAt}),void this.setState({playingAtSlider:this.state.playingAt});if("setB"!==e.target.name)if("LoopAB"!==e.target.name)if("resetAB"!==e.target.name){if(e.target.name===E.resetAudio){if(!C)return;P&&(P.disconnect(),P.off(),P=null),n.close(),n=new window.AudioContext,r=n.createGain();var t=n.createBuffer(1,1,44100),a=n.createBufferSource();return a.buffer=t,a.connect(n.destination),void a.start()}}else{if(null===this.params.audioBuffer)return;this.setState({timeA:0,timeB:this.params.audioBuffer.duration,playingAtSlider:0})}else{if(!this.params.audioBuffer)return;if(this.state.loopButtonStr===E.loopAB){if(this.params.isPlaying)return;this.params.loop=!0,this.playAB(this.state.timeA,this.state.timeB),this.setState({loopButtonStr:E.stopLoop}),this.setState({startButtonStr:E.playOnce})}else if(this.state.loopButtonStr===E.stopLoop){if(!this.params.isPlaying)return;P&&(P.disconnect(),P.off(),P=null),this.params.isPlaying=!1,this.params.loop=!1,this.setState({loopButtonStr:E.loopAB})}}else this.state.playingAt>=this.state.timeA?this.setState({timeB:parseFloat(this.state.playingAt)}):this.setState({timeB:parseFloat(this.state.timeA)+parseFloat(10)})}else this.params.loopInterval=parseInt(e.target.value,10)}},{key:"playAB",value:function(e,t){var a=this;if(!this.params.isPlaying&&null!==this.params.audioBuffer){t<=e&&(t=e+5,this.setState({timeB:t}));var i=this.params,l=i.audioBuffer,o=i.loopInterval,s=e*l.sampleRate,p=t*l.sampleRate,u=0;this.params.loop&&(u=o*l.sampleRate);var c=n.createBuffer(2,p-s+u,l.sampleRate),h=l.getChannelData(0),d=l.getChannelData(1);h=h.subarray(s,p);for(var m=c.getChannelData(0),S=0;S<h.length;S++)m[S+u]=h[S];if(l.numberOfChannels>=2){m=c.getChannelData(1),d=d.subarray(s,p);for(var v=0;v<d.length;v++)m[v+u]=d[v]}P&&(P.disconnect(),P=null),(P=new f.a(n,c,16384)).tempo=this.state.playSpeed/100,P.pitch=Math.pow(2,this.state.playPitch/12);var g=P.formattedDuration;P.on("play",(function(t){var n=parseFloat(e)+parseFloat(t.timePlayed);if(a.params.loop&&(n-=o),a.setState({playingAt:n}),a.setState({playingAtSlider:n}),t.formattedTimePlayed>=g)return P.disconnect(),P.off(),P=null,a.params.isPlaying=!1,a.state.startButtonStr===E.pause&&(a.setState({playingAt:0}),a.setState({playingAtSlider:0}),a.setState({startButtonStr:E.playOnce})),void(a.params.loop&&a.playAB(a.state.timeA,a.state.timeB))})),P.connect(r),r.connect(n.destination),n.resume(),this.params.isPlaying=!0,this.params.loop||this.setState({startButtonStr:E.pause})}}},{key:"handleLang",value:function(e){if(!this.params.isPlaying&&"language"===e.target.name){var t=E;return this.state.ja?(E=A,this.setState({ja:!1})):(E=b,this.setState({ja:!0})),this.state.startButtonStr===t.loadFile?this.setState({startButtonStr:E.loadFile}):this.state.startButtonStr===t.playOnce?this.setState({startButtonStr:E.playOnce}):this.state.startButtonStr===t.pause&&this.setState({startButtonStr:E.pause}),this.state.loopButtonStr===t.loopAB?this.setState({loopButtonStr:E.loopAB}):this.state.loopButtonStr===t.stopLoop&&this.setState({loopButtonStr:E.stopLoop}),void(this.state.saveButtonStr===t.exportWav?this.setState({saveButtonStr:E.exportWav}):this.state.saveButtonStr===t.abortExport&&this.setState({saveButtonStr:E.abortExport}))}}}]),t}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(l.a.createElement(w,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},3:function(e){e.exports=JSON.parse('{"name":"variablespeedplayer","version":"0.1.0","private":true,"homepage":"/demos/variableplayer/20200401","subversion":"-06","dependencies":{"audiobuffer-to-wav":"^1.0.0","file-saver":"^2.0.2","react":"^16.13.1","react-dom":"^16.13.1","react-scripts":"3.3.1","soundtouchjs":"^0.1.10","whatwg-fetch":"^3.0.0"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":[">0.2%","not dead","not ie <= 11","not op_mini all"]}')},4:function(e){e.exports=JSON.parse('{"us":{"title":"KG\'s variable speed/pitch player","input":"Select audio file (local/cloud storage)","speed":"Speed(%)","reset":"Reset","pitch":"Pitch(semitone.cents)","time":"Time(sec)","timeNote":"(Start, A, B set)","setA":"setA","setB":"setB","resetAB":"ResetAB","volume":"Volume(%)","volumeNote":"(May change during export)","loadFile":"selectFile!","playOnce":"PlayOnce","pause":"Pause","rewind":"Rewind","loopAB":"loopAB","stopLoop":"StopLoop","interval":"interval(sec)","exportWav":"ExportAfterPlayback","abortExport":"AbortExport","resetAudio":"iOSAudioReset","version":"Version","guide":"guide/update","homepage":"https://goto920.github.io/demos/variableplayer/"},"ja":{"title":"KG\'s \u901f\u5ea6/\u97f3\u7a0b\u53ef\u5909\u30d7\u30ec\u30fc\u30e4","input":"\u30aa\u30fc\u30c7\u30a3\u30aa\u30fb\u30d5\u30a1\u30a4\u30eb\u9078\u629e (\u30ed\u30fc\u30ab\u30eb/\u30af\u30e9\u30a6\u30c9)","speed":"\u901f\u5ea6(%)","reset":"\u30ea\u30bb\u30c3\u30c8","pitch":"\u97f3\u7a0b(\u534a\u97f3.\u534a\u97f3\u306e1/100)","time":"\u6642\u523b(\u79d2)","timeNote":"(\u4e00\u56de\u518d\u751f\u958b\u59cb, A, B\u8a2d\u5b9a)","setA":"\u8a2d\u5b9aA","setB":"\u8a2d\u5b9aB","resetAB":"\u30ea\u30bb\u30c3\u30c8AB","volume":"\u97f3\u91cf(%)","volumeNote":"(\u66f8\u304d\u51fa\u3057\u4e2d\u5909\u66f4\u53ef)","loadFile":"\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u3093\u3067\u306d!","playOnce":"\u4e00\u56de\u518d\u751f","pause":"\u4e00\u6642\u505c\u6b62","rewind":"\u5dfb\u304d\u623b\u3057","loopAB":"AB\u30eb\u30fc\u30d7\u518d\u751f","stopLoop":"\u30eb\u30fc\u30d7\u505c\u6b62","interval":"\u9593\u9694(\u79d2)","exportWav":"\u518d\u751f\u5f8c\u66f8\u304d\u51fa\u3057","abortExport":"\u66f8\u304d\u51fa\u3057\u4e2d\u6b62","resetAudio":"iOS\u30aa\u30fc\u30c7\u30a3\u30aa\u30ea\u30bb\u30c3\u30c8","version":"\u7248","guide":"\u30ac\u30a4\u30c9/\u66f4\u65b0","homepage":"https://goto920.github.io/demos/variableplayer/index-jp.html"}}')}},[[14,1,2]]]);
//# sourceMappingURL=main.f9bdf889.chunk.js.map