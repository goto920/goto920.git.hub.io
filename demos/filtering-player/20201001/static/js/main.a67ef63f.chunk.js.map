{"version":3,"sources":["effectorClass.js","App.js","serviceWorker.js","index.js"],"names":["Effector","shiftSize","sampleRate","this","rfft","FFTR","fftObjBuffer","lastInput","Float32Array","fill","lastOut","filterChain","calcFFT","bind","justFFT","calcPan","calcPerc","fftFilter","addFilter","clearAllFilter","presetFilter","fromPan","fromFreq","toPan","toFreq","action","fromFreqIndex","Math","min","round","toFreqIndex","push","length","inputBuffer","outputBuffer","channel","numberOfChannels","inputData","getChannelData","outputData","AudioBuffer","prototype","copyToChannel","sample","type","option","width","console","log","fftWindowInput","fftObj","pcmData","fftCoef","inverse","slice","forward","Windowing","hann","power","freqBin","pan","panAmp","percL","percR","fft","numCoef","base","innerProd","crossProd","abs","sqrt","pow","absL","absR","absLR","frac","max","isNaN","median","arr","mid","floor","nums","sort","a","b","buflen","from","to","pMedianL","pMedianR","powerArrayL","powerArrayR","time","hMedianL","hMedianR","retval","perc","splice","fftL","fftR","outL","outR","i","filter","f","version","packageJSON","homepage","subversion","jaText","messages","ja","usText","us","m","window","AudioContext","webkitAudioContext","OfflineAudioContext","webkitOfflineAudioContext","audioCtx","offlineCtx","gainNode","effector","iOS","navigator","userAgent","match","App","props","params","inputAudio","outputAudio","outputLength","filename","currentSource","isPlaying","isBatchPlaying","isRendering","playStartTime","effectNode","fftShift","counter","state","playingAt","A","B","filterType","centerWidth","playVolume","startButtonStr","processBatchButtonStr","playBatchButtonStr","saveButtonStr","loadFile","handleLang","handleTimeRange","handleVolumeSlider","handlePlay","handleOffline","handleSave","selectFilter","fakeDownload","event","close","createGain","addEventListener","handleWindowClose","removeEventListener","duration","startBStyle","className","title","name","onClick","accept","onChange","value","toFixed","style","cursor","allowCross","trackStyle","backgroundColor","handleStyle","border","borderTop","href","target","rel","guide","e","files","file","reader","FileReader","onload","decodeAudioData","result","audioBuffer","setState","error","err","readAsArrayBuffer","vol","parseInt","gain","parseFloat","buffer","createBuffer","source","createBufferSource","connect","destination","start","original","modified","channels","bufferSize","createJavaScriptNode","createScriptProcessor","onaudioprocess","process","leftOut","rightOut","processedLeft","processedRight","offset","stop","disconnect","onaudioprrocess","trimOutput","addOneSec","output","input","processed","processedL","processedR","startRendering","oncomplete","currentTime","begin","end","inL","inR","outFileName","split","blob","Blob","toWav","saveAs","Component","Boolean","location","hostname","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.a67ef63f.chunk.js","sourcesContent":["// import {RFFT} from 'fftw-js'; // fftw-js\nimport {FFTR} from 'kissfft-js';\nimport Windowing from 'fft-windowing';\n\nclass Effector {\n\n  constructor(shiftSize,sampleRate){\n    this.shiftSize = shiftSize;\n    this.sampleRate = sampleRate;\n\n//    this.rfft = new RFFT(2*this.shiftSize); // fftw-js\n    this.rfft = new FFTR(2*this.shiftSize); // kissfft-js\n\n    this.fftObjBuffer = []; // up to 17\n\n    this.lastInput = [];\n    this.lastInput[0] = new Float32Array(shiftSize).fill(0);\n    this.lastInput[1] = new Float32Array(shiftSize).fill(0);\n\n    this.lastOut = [];\n    this.lastOut[0] = new Float32Array(shiftSize).fill(0);\n    this.lastOut[1] = new Float32Array(shiftSize).fill(0);\n\n    this.filterChain = []; \n       // fromPan, fromFreq, toPan, toFreq, action \n       // ('T': through, 'M': mute, 'P': percussive, 'H': harmonic)\n\n    this.calcFFT = this.calcFFT.bind(this); // forward FFT \n    this.justFFT = this.justFFT.bind(this); // forward FFT \n    this.calcPan = this.calcPan.bind(this); // Pan calculation\n    this.calcPerc = this.calcPerc.bind(this);\n    this.fftFilter = this.fftFilter.bind(this);\n\n    this.addFilter = this.addFilter.bind(this);\n    this.clearAllFilter = this.clearAllFilter.bind(this);\n\n    this.presetFilter = this.presetFilter.bind(this);\n\n  }\n\n  addFilter(fromPan, fromFreq, toPan, toFreq, action){ \n\n    let fromFreqIndex = Math.min(this.shiftSize, \n            Math.round(this.shiftSize*(2*fromFreq/this.sampleRate)));\n    let toFreqIndex = Math.min(this.shiftSize, \n            Math.round(this.shiftSize*(2*toFreq/this.sampleRate)));\n\n    this.filterChain.push({\n      fromPan: fromPan, fromFreqIndex: fromFreqIndex,\n      toPan: toPan, toFreqIndex: toFreqIndex,\n      action: action\n    });\n\n  }\n\n  clearAllFilter(){ this.filterChain.length = 0; }\n\n  copy(inputBuffer, outputBuffer){ // for test\n\n    for (let channel = 0; channel < inputBuffer.numberOfChannels;\n           channel++){\n      let inputData = inputBuffer.getChannelData(channel);\n      let outputData = outputBuffer.getChannelData(channel);\n\n      if (AudioBuffer.prototype.copyToChannel)\n          outputBuffer.copyToChannel(inputData, channel,0);\n      else \n         for (let sample = 0; sample < inputBuffer.length; sample++)\n              outputData[sample] = inputData[sample];\n\n    } // end for channel\n    return;\n  }\n\n  presetFilter(type, option){\n\n     this.clearAllFilter();\n     console.log('filter, option ', type, option);\n\n     let width;\n     switch (type){\n       case 'bypass': break;\n       case 'drumCover':\n         width = option;\n         this.addFilter(-1,0,1,30000,\"H\");\n         this.addFilter(-width/2,220,width/2,4000,\"T\");\n         this.addFilter(-1.0,220,-0.9,4000,\"T\");\n         this.addFilter(0.9,220,1.0,4000,\"T\");\n       break;\n       case 'karaokeMale':\n         width = option;\n         this.addFilter(-width/2,220,width/2,8000,\"M\");\n       break;\n       case 'karaokeFemale':\n         width = option;\n         this.addFilter(-width/2,350,width/2,8000,\"M\");\n       break;\n       case 'percussive':\n         this.addFilter(-1,0,1,30000,\"P\");\n       break;\n       case 'harmonic':\n         this.addFilter(-1,0,1,30000,\"H\");\n       break;\n       default:\n     }\n  }\n\n  process(inputBuffer, outputBuffer){\n\n    if (inputBuffer.numberOfChannels !== 2) return;\n\n// prepare input\n// FFT window = 2*this.shiftSize window = 2*this.shiftSize\n// channel: 0(left), 1(right)\n    let fftWindowInput = [];\n       fftWindowInput[0] = new Float32Array(this.shiftSize*2);\n       fftWindowInput[1] = new Float32Array(this.shiftSize*2);\n\n    for (let channel = 0; channel <= 1 ; channel++){\n\n      let inputData = inputBuffer.getChannelData(channel);\n\n      for (let sample = 0; sample < 2*this.shiftSize; sample++){ \n        if (sample < this.shiftSize) \n          fftWindowInput[channel][sample] = this.lastInput[channel][sample];\n        else if (sample < this.shiftSize + inputData.length) \n          fftWindowInput[channel][sample] = inputData[sample - this.shiftSize];\n        else fftWindowInput[channel][sample] = 0;\n      }\n\n      for (let sample = 0; sample < this.shiftSize; sample++) \n        this.lastInput[channel][sample] \n          = fftWindowInput[channel][this.shiftSize + sample];\n\n    } // end for channel\n\n    let fftObj = this.calcFFT(fftWindowInput);\n    // fftObj is null until the buffer has 17 fftObj's\n\n// decode FFT\n    let pcmData = []; // this.shiftSize*2  \n\n//    let fftCoef = this.justFFT(fftWindowInput); // test\n\n    if (fftObj !== null) {\n      let fftCoef = this.fftFilter(fftObj);\n\n       pcmData[0] = this.rfft.inverse(fftCoef[0]).slice(); \n       pcmData[1] = this.rfft.inverse(fftCoef[1]).slice();\n\n       // console.log(pcmData[0]);\n\n    } else {\n       // console.log ('fftObj is null');\n       pcmData[0] = new Float32Array(this.shiftSize*2 + 2).fill(0);\n       pcmData[1] = new Float32Array(this.shiftSize*2 + 2).fill(0);\n    }\n\n// Add two outputs in overlapped hann window \n    for(let channel = 0; channel <= 1; channel++){\n      let outputData = outputBuffer.getChannelData(channel);\n\n      for (let sample = 0; sample < this.shiftSize; sample++)\n         outputData[sample] = this.lastOut[channel][sample] \n           + pcmData[channel][sample]/(2*this.shiftSize);\n\n      for (let sample = 0; sample < this.shiftSize; sample++)\n         this.lastOut[channel][sample] \n           = pcmData[channel][this.shiftSize + sample]/(2*this.shiftSize);\n      // store latter half of fft inverse output\n\n    }\n\n    return;\n  }\n\n  justFFT (fftWindowInput){\n\n     // console.log(fftWindowInput[0]);\n\n    let fftCoef = [];\n    fftCoef[0] = this.rfft.forward(Windowing.hann(fftWindowInput[0])).slice();\n    fftCoef[1] = this.rfft.forward(Windowing.hann(fftWindowInput[1])).slice();\n\n    return fftCoef;\n  }\n\n  calcFFT (fftWindowInput){\n\n    let fftCoef = [];\n    fftCoef[0] = this.rfft.forward(Windowing.hann(fftWindowInput[0])).slice();\n    fftCoef[1] = this.rfft.forward(Windowing.hann(fftWindowInput[1])).slice();\n    // 0: Left, 1: Right\n\n    let power = [];\n      power[0] = new Float32Array(this.shiftSize+1)\n      power[1] = new Float32Array(this.shiftSize+1)\n    // 0: Left, 1: Right\n    \n    for (let freqBin = 0; freqBin <= this.shiftSize; freqBin++){\n      power[0][freqBin] = fftCoef[0][2*freqBin]* fftCoef[0][2*freqBin]\n               + fftCoef[0][2*freqBin+1]* fftCoef[0][2*freqBin+1]\n      power[1][freqBin] = fftCoef[1][2*freqBin]* fftCoef[1][2*freqBin]\n               + fftCoef[1][2*freqBin+1]* fftCoef[1][2*freqBin+1]\n    }\n\n    let fftObj = { \n      fftCoef: fftCoef,\n      pan:  [],\n      panAmp: [],\n      power: power,\n      percL: [],\n      percR: []\n    };   \n\n    this.calcPan(fftObj);\n\n    this.fftObjBuffer.push(fftObj);\n\n    return this.calcPerc(this.fftObjBuffer); \n\n  } // end calcFFT\n\n  calcPan (fftObj) {\n\n    const fft = fftObj.fftCoef;\n    let numCoef = fft[0].length/2;\n    let pan = new Float32Array(numCoef);\n    let panAmp = new Float32Array(numCoef);\n\n/*\n  Note: frequency-domain data is stored from dc up to 2pi. \n  so cx_out[0] is the dc bin of the FFT and cx_out[nfft/2] is \n  the Nyquist bin (if exists)\n*/\n\n//    console.log('numCoef', numCoef);\n\n    for(let freqBin = 0; freqBin < numCoef; freqBin++){\n\n      let base = 2*freqBin; \n\n      let innerProd = fft[0][base]*fft[1][base]\n                      + fft[0][base+1]*fft[1][base+1]\n\n      let crossProd = fft[0][base]*fft[1][base+1] // Don't forget minus\n                      - fft[0][base+1]*fft[1][base]\n\n      let abs = Math.sqrt(\n         Math.pow(fft[0][base] + fft[1][base],2)\n       + Math.pow(fft[0][base+1] + fft[1][base+1],2)\n      );\n\n      let absL = Math.sqrt( \n          Math.pow(fft[0][base],2) + Math.pow(fft[0][base+1],2));\n      let absR = Math.sqrt(\n          Math.pow(fft[1][base],2) + Math.pow(fft[1][base+1],2));\n\n      let absLR = Math.sqrt(\n        Math.pow(fft[0][base] - fft[1][base],2)\n        + Math.pow(fft[0][base+1] - fft[1][base+1],2)\n      );\n\n      let frac = 0; \n      if (absL < absR){\n        if (innerProd < 0) {\n          frac = 0;\n          panAmp[freqBin] = (absLR - absL)/abs;\n        } else if (innerProd <= absR*absR) {\n          frac = innerProd/(absR*absR); \n          panAmp[freqBin] = Math.max(absL,absLR) - Math.abs(crossProd)/absR; \n        } else {\n          frac = 1;\n          panAmp[freqBin] = absL - absLR;\n        }\n        pan[freqBin] = (1-frac)/(1+frac);\n        // console.log('bin, fracA', freqBin, frac);\n\n      } else { // absL >= absR\n        if (innerProd < 0) {\n          frac = 0;\n          panAmp[freqBin] = (absLR - absR)/abs;\n        } else if (innerProd <= absL*absL) {\n          frac = innerProd/(absL*absL); \n          panAmp[freqBin] = Math.max(absR,absLR) - Math.abs(crossProd)/absL; \n        } else {\n          frac = 1;\n          panAmp[freqBin] = absR - absLR;\n        }\n        pan[freqBin] = (frac-1)/(1+frac);\n      }\n    // console.log('bin, fracB', freqBin, frac);\n\n       if (isNaN(pan[freqBin])) pan[freqBin] = 0;\n       if (isNaN(panAmp[freqBin])) panAmp[freqBin] = 0;\n\n    } // end for freqBin\n\n    fftObj.pan = pan;\n    fftObj.panAmp = panAmp;\n\n    return;\n  }\n\n\n  calcPerc(fftObjBuffer){\n\n    const median = arr => {\n      const mid = Math.floor(arr.length / 2),\n      nums = [...arr].sort((a, b) => a - b);\n      return arr.length % 2 !== 0 ? nums[mid] : (nums[mid - 1] + nums[mid]) / 2;\n    };\n\n    let buflen = fftObjBuffer.length;\n    // console.log ('buflen', buflen);\n\n    if (buflen < 17) return null; // not enough dat\n\n    let percL = new Float32Array(this.shiftSize+1).fill(0.5); // +1 for DC\n    let percR = new Float32Array(this.shiftSize+1).fill(0.5); \n      // also used as power\n\n    const index = 8;\n    const fftObj = fftObjBuffer[index];\n\n    for (let freqBin = 0; freqBin <= this.shiftSize; freqBin++){\n      let from = Math.max(0, freqBin - 9);\n      let to =  Math.min(freqBin + 9, this.shiftSize + 1); // to (not incl.) \n      let pMedianL = median(fftObj.power[0].slice(from,to));\n      let pMedianR = median(fftObj.power[1].slice(from,to));\n\n      let powerArrayL = [];\n      let powerArrayR = [];\n\n      for (let time = 0; time < buflen; time++){ // buflen (max 17)\n        powerArrayL.push(fftObjBuffer[time].power[0][freqBin]);\n        powerArrayR.length = 0;\n        powerArrayR.push(fftObjBuffer[time].power[1][freqBin]);\n      }\n\n      let hMedianL = median(powerArrayL);\n      let hMedianR = median(powerArrayR);\n\n      percL[freqBin] = (pMedianL*pMedianL)/\n         (pMedianL*pMedianL + hMedianL*hMedianL);\n      if (isNaN(percL[freqBin])) percL[freqBin] = 0.5;\n      percR[freqBin] = (pMedianR*pMedianR)/\n         (pMedianR*pMedianR + hMedianR*hMedianR);\n      if (isNaN(percR[freqBin])) percR[freqBin] = 0.5;\n\n    }\n\n    fftObjBuffer[index].percL = percL;\n    fftObjBuffer[index].percR = percR;\n\n    let retval = { \n      fftCoef: [fftObj.fftCoef[0].slice(), fftObj.fftCoef[1].slice()],\n      pan:  fftObj.pan.slice(),\n      panAmp: fftObj.panAmp.slice(),\n      power: [fftObj.power[0].slice(), fftObj.power[1].slice()],\n      perc: [percL.slice(), percR.slice()]\n    };   \n\n    if (buflen >= 17) fftObjBuffer.splice(0,1);\n\n    return retval;\n  }\n\n  fftFilter (fftObj){\n\n    const fftL = fftObj.fftCoef[0];\n    const fftR = fftObj.fftCoef[1];\n    const percL = fftObj.perc[0];\n    const percR = fftObj.perc[1];\n\n    let outL = fftL.slice();\n    let outR = fftR.slice();\n\n    for (let i = 0; i < this.filterChain.length; i++){\n      let filter = this.filterChain[i];\n      let action = filter.action;\n\n      for (let f = filter.fromFreqIndex; f <= filter.toFreqIndex; f++){\n\n        if (fftObj.pan[f] < filter.fromPan \n          || fftObj.pan[f] > filter.toPan) continue;\n\n        switch (action) {\n          case 'T': // original signal\n            outL[2*f] = fftL[2*f]; outL[2*f+1] = fftL[2*f + 1];\n            outR[2*f] = fftR[2*f]; outR[2*f+1] = fftR[2*f + 1];\n          break;\n\n          case 'M': // mute\n            outL[2*f] = outL[2*f+1] = 0; // real, image\n            outR[2*f] = outR[2*f+1] = 0; // real, image\n          break;\n\n          case 'P':\n            outL[2*f] = fftL[2*f]*percL[f];\n            outL[2*f+1] = fftL[2*f+1]*percL[f];\n            outR[2*f] = fftR[2*f]*percR[f]; \n            outR[2*f+1] = fftR[2*f+1]*percR[f];\n          break;\n          case 'H':\n            outL[2*f] = fftL[2*f]*(1-percL[f]);\n            outL[2*f+1] = fftL[2*f+1]*(1-percL[f]);\n            outR[2*f] = fftR[2*f]*(1-percR[f]); \n            outR[2*f+1] = fftR[2*f+1]*(1-percR[f]);\n          break;\n\n          default:\n            console.log('Filter undef action', action);\n        }\n\n      }\n\n    }\n\n    return [outL, outR];\n  }\n\n}\n\nexport default Effector;\n","import React, {Component} from 'react';\n// import logo from './logo.svg';\nimport './App.css';\nimport packageJSON from '../package.json';\nimport messages from './language.json'; // US and JA message\n// File Saver\nimport * as toWav from 'audiobuffer-to-wav';\nimport {saveAs} from 'file-saver';\n// FFT\n// import {RFFT} from 'fftw-js';\n//import Windowing from 'fft-windowing';\nimport Effector from './effectorClass.js';\n// import Slider, {Range} from 'rc-slider';\nimport {Range} from 'rc-slider';\nimport 'rc-slider/assets/index.css';\n\n// Global variables\nconst version = (packageJSON.homepage + packageJSON.subversion).slice(-11);\nconst jaText = messages.ja;\nconst usText = messages.us;\nvar m = usText; // default\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext\nwindow.OfflineAudioContext = window.OfflineAudioContext \n     || window.webkitOfflineAudioContext;\n\nvar audioCtx = null;\nvar offlineCtx = null;\nvar gainNode = null;\nvar effector = null;\n\nvar iOS = false;\nif(  navigator.userAgent.match(/iPhone/i) \n  || navigator.userAgent.match(/iPod/i)\n  || navigator.userAgent.match(/iPad/i)){\n  iOS = true;\n}\n\n\n////////////////////////\nclass App extends Component {\n  constructor (props){\n    super();\n\n    this.params = {\n      inputAudio: null,\n      outputAudio: null,\n      outputLength: 0,\n      filename: null,\n      currentSource: null,\n      isPlaying: false,\n      isBatchPlaying: false,\n      isRendering: false,\n      playStartTime: 0,\n      effectNode: null,\n      fftShift: 512,\n    }\n\n    this.counter = 0;\n\n    this.state = {\n      ja: false,\n      playingAt: 0, \n      A: 0, B: 0,\n      filterType: \"bypass\",\n      centerWidth: 0.2,\n      playVolume: 80,\n      startButtonStr: 'NotYet', // Start/Pause\n      processBatchButtonStr: 'NotYet', \n       // NotYet/Start/Abort\n      playBatchButtonStr: 'NotYet', \n       // NotYet/Play/Pause\n      saveButtonStr: 'NotYet' \n       // NotYet/Save/Abort\n    }\n\n    this.loadFile = this.loadFile.bind(this);\n    this.handleLang = this.handleLang.bind(this);\n//    this.handleTimeSlider = this.handleTimeSlider.bind(this);\n    this.handleTimeRange = this.handleTimeRange.bind(this);\n    this.handleVolumeSlider = this.handleVolumeSlider.bind(this);\n    this.handlePlay = this.handlePlay.bind(this);\n    this.handleOffline = this.handleOffline.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n    this.selectFilter = this.selectFilter.bind(this);\n    this.fakeDownload = this.fakeDownload.bind(this);\n    // this.addOneSec = this.addOneSec(this);\n  }\n\n  handleWindowClose(event) { \n    audioCtx.close();\n  }\n\n  componentDidMount () { // after render()\n    audioCtx = new window.AudioContext();\n    gainNode = audioCtx.createGain();\n    window.addEventListener('beforeClosing', this.handleWindowClose);\n  }\n \n    componentWillUnmount () { // before closing app\n    window.removeEventListener('beforeClosing', this.handleWindowClose)\n  }\n\n// GUI \n  render(){\n\n    let duration = 0;\n    if (this.params.inputAudio)\n      duration = this.params.inputAudio.duration;\n\n    let startBStyle = {};\n/*\n    if (this.state.startButtonStr === 'Pause'\n       || this.state.processtBatchButtonStr === 'Abort'\n       || this.state.playBatchButtonStr === 'Pause'\n       ) startBStyle = {color: 'green'};\n*/\n\n    const rangeStyle = {width: '85%', cursor: 'pointer'};\n    const dotted = {border: 'none', borderTop: '1px dotted blue'};\n\n    return(\n      <div className=\"App\">\n       {m.title}\n       <span className='small-button'> &nbsp;&nbsp;\n       <button name='language' onClick={this.handleLang}>\n       {this.state.ja ? 'En(US)' : '日本語'}</button> \n       </span>\n       <hr />\n       1) Select stereo audio file (local/cloud)<br/>\n       <span className='selectFile'>\n       <input type='file' name='loadFile' \n          accept='audio/*' onChange={this.loadFile} /><br />\n       </span>\n       <hr />\n       <span className='selector'>\n       2) Filter: &nbsp;\n       <select name=\"selectFilter\" value={this.state.filterType}\n        onChange={this.selectFilter}>\n       <option value=\"bypass\">bypass</option>\n       <option value=\"drumCover\">drumCover</option>\n       <option value=\"karaokeMale\">karaokeMale</option>\n       <option value=\"karaokeFemale\">karaokeFemale</option>\n       <option value=\"percussive\">percussive</option>\n       <option value=\"harmonic\">harmonic</option>\n       <option value=\"setWithGUI\">setWithGUI</option>\n       </select><br />\n       centerWidth: &nbsp; \n       <select name=\"centerWidth\" \n       value = {this.state.centerWidth} onChange={this.selectFilter}>\n       <option value=\"0.1Total: 242.\">0.1</option>\n       <option value=\"0.2\">0.2</option>\n       <option value=\"0.3\">0.3</option>\n       <option value=\"0.4\">0.4</option>\n       <option value=\"0.5\">0.5</option>\n       <option value=\"0.6\">0.6</option>\n       <option value=\"0.7\">0.7</option>\n       </select>\n       &nbsp; Range: {-this.state.centerWidth/2} -- {this.state.centerWidth/2}\n       </span>\n       <hr />\n        <span>\n        3) Time Range: {this.state.A.toFixed(2)} -- {this.state.B.toFixed(2)}\n        <center>\n        <Range style = {rangeStyle} min={0} max={duration} \n           value = {[this.state.A,this.state.playingAt, this.state.B]} \n           allowCross={false}\n     trackStyle={[{ backgroundColor: 'red' }, { backgroundColor: 'green' }]}\n     handleStyle={[{backgroundColor: 'yellow' }, \n                   {backgroundColor: 'gray' },\n                   {backgroundColor: 'yellow' }]}\n           onChange={this.handleTimeRange}\n           />\n        </center>\n        Total: {duration.toFixed(2)} sec &nbsp;&nbsp; \n        Current: {this.state.playingAt.toFixed(2)}\n        </span>\n       <hr />\n       <span>\n       4A) Batch: &nbsp; \n          <button name='startBatch' style={startBStyle}\n          onClick={this.handleOffline} >\n          {this.state.processBatchButtonStr}</button> &nbsp;&nbsp;\n          Play: &nbsp;&nbsp;\n          <button name='playBatch' style={startBStyle}\n          onClick={this.handleOffline} >\n          {this.state.playBatchButtonStr}</button> &nbsp;&nbsp;\n          <button name='stopBatchPlay' onClick={this.handleOffline} >\n          Stop</button>\n       <hr style={dotted} />\n       4B) Realtime: &nbsp;\n          <button name='startPause' style={startBStyle} \n          onClick={this.handlePlay} >\n          {this.state.startButtonStr}</button> &nbsp;&nbsp; \n          <button name=\"stop\" onClick={this.handlePlay} >Stop</button><br />\n       </span> \n       <hr />\n       5) Save current output: &nbsp;\n          <button name=\"save\" onClick={this.handleSave} >\n          {this.state.saveButtonStr}</button> \n       \n       <hr />\n        Playback Vol: {this.state.playVolume} <br />\n        <span className='slider'> \n         <center>\n         000 <input type='range' name='volumeSlider' min='0' max='150'\n         value = {this.state.playVolume} \n           onChange={this.handleVolumeSlider} /> 150<br />\n         </center>\n        </span>\n       <hr />\n        Version: {version}, &nbsp;\n        <a href={m.homepage} \n         target=\"_blank\" rel=\"noopener noreferrer\">{m.guide}</a>\n       <hr />\n      </div>\n    );\n  } // end render()\n\n// event handlers\n  loadFile (e) {\n    if (e.target.name !== 'loadFile') return;\n    if (e.target.files.length === 0) return;\n    if (this.params.isPlaying) return;\n\n    let file = e.target.files[0]; \n    this.params.filename = file.name;\n \n    let reader = new FileReader();\n    reader.onload = function(e) {\n      audioCtx.decodeAudioData(reader.result, \n        function(audioBuffer) {\n          this.params.inputAudio = audioBuffer;\n\n          if (audioBuffer.numberOfChannels === 2){\n            this.setState({playingAt: 0});\n            this.setState({startButtonStr: 'Play'});\n            this.setState({A: 0, B: audioBuffer.duration});\n            this.setState({processBatchButtonStr: 'Start', \n                           saveButtonStr: 'NotYet'});\n            effector = null;\n            effector \n              = new Effector(this.params.fftShift,audioBuffer.sampleRate);\n          }\n\n        }.bind(this),\n          function (error) { console.log (\"Filereader error: \" + error.err) \n        }\n      );\n\n    }.bind(this);\n\n    reader.readAsArrayBuffer(file);\n\n  }\n\n  handleLang(e){\n    if (e.target.name !== 'language') return;\n\n    if (this.state.ja) {\n      m = usText; this.setState({ja: false}); \n    } else {\n      m = jaText; this.setState({ja: true}); \n    }\n  }\n\n  handleVolumeSlider(e){\n    if (e.target.name !== 'volumeSlider') return;\n\n    let vol = parseInt(e.target.value);\n    gainNode.gain.value = vol/100.0;\n    this.setState({playVolume: vol});\n    return;\n  }\n\n/*\n  handleTimeSlider(e){\n    if (this.params.isPlaying) return;\n    if (e.target.name !== 'timeSlider') return;\n    this.setState({playingAt: parseFloat(e.target.value)});\n  }\n*/\n\n  handleTimeRange(value){\n    if (this.params.isPlaying) return;\n\n    this.setState({\n      A: parseFloat(value[0]), \n      playingAt: parseFloat(value[1]),\n      B: parseFloat(value[2])\n    });\n  }\n\n  handlePlay(e){\n\n\n    if (e.target.name === 'stop'){\n      if (this.state.startButtonStr !== 'NotYet') {\n        if (this.params.currentSource !== null){\n          this.params.currentSource.stop();\n          this.params.currentSource = null;\n        }\n\n        let effectNode = this.params.effectNode;\n        if (effectNode !== null){\n          effectNode.disconnect();\n          effectNode.onaudioprocess = null;\n        }\n        this.params.outputLength = this.state.playingAt - this.state.A;\n        this.setState({playingAt: this.state.A, startButtonStr: 'Play',\n          saveButtonStr: 'Save'});\n        this.params.isPlaying = false;\n      }\n      return;\n    }\n\n    if (e.target.name === 'startPause'){\n\n      if (this.state.startButtonStr === 'Play'){ \n\n       if (this.params.isPlaying \n          || this.params.inputAudio.numberOfChannels !== 2) return;\n\n       this.params.isPlaying = true;\n\n// unlock iOS\n       if(iOS) {\n         let buffer = audioCtx.createBuffer(1,1,44100); \n         let source = audioCtx.createBufferSource();\n         source.buffer = buffer;\n         source.connect (audioCtx.destination);\n         source.start();\n       } \n// End unlock iOS\n\n// Playing\n       let source = audioCtx.createBufferSource();\n       this.params.currentSource = source;\n\n       // add 0.5 sec (sampleRate/2) at the beginning and the end\n       let original = this.params.inputAudio;\n       let modified = audioCtx.createBuffer(\n           original.numberOfChannels, \n           original.length + original.sampleRate,\n           original.sampleRate\n       ); \n\n       for (let channel = 0; channel < modified.numberOfChannels; channel++){\n         let from = original.getChannelData(channel);\n         let to = modified.getChannelData(channel);\n         for (let sample = 0; sample < modified.sampleRate/2; sample++) \n            to[sample] = 0;\n         for (let sample = modified.sampleRate/2; \n            sample < original.length; sample++) \n            to[sample] = from[sample - modified.sampleRate/2];\n         for (let sample = original.length; sample < modified.length; sample++)\n            to[sample] = 0; \n       }\n\n       source.buffer = modified;\n\n// Create effectNode\n       let channels = this.params.inputAudio.numberOfChannels;\n       let bufferSize = this.params.fftShift; // 1024 window half step\n\n       let effectNode = null;\n       if (audioCtx.createJavaScriptNode) {\n          effectNode \n           = audioCtx.createJavaScriptNode(bufferSize,channels,channels);\n          // console.log ('createJavaScriptNode');\n       } else if (audioCtx.createScriptProcessor) {\n         effectNode = audioCtx.createScriptProcessor(bufferSize, \n          channels,channels);\n          // console.log ('createScriptProcessor');\n       } // end if audioCtx\n       this.params.effectNode = effectNode;\n\n// Connect\n        source.connect(effectNode)\n        effectNode.connect(gainNode);\n        gainNode.connect(audioCtx.destination);\n        source.start(0,this.state.playingAt);\n\n        this.params.outputAudio =  audioCtx.createBuffer(\n          modified.numberOfChannels, modified.length, modified.sampleRate);\n\n        this.counter = 0;\n        effectNode.onaudioprocess = function(e) {\n\n          let inputBuffer = e.inputBuffer;\n          let outputBuffer = e.outputBuffer;\n          effector.process(inputBuffer, outputBuffer);\n\n         let leftOut = outputBuffer.getChannelData(0);\n         let rightOut = outputBuffer.getChannelData(1);\n\n        // save data\n         let processedLeft = this.params.outputAudio.getChannelData(0);\n         let processedRight = this.params.outputAudio.getChannelData(1);\n\n         for (let sample = 0; sample < this.params.fftShift; sample++){\n           let offset = this.counter*this.params.fftShift;\n           processedLeft[offset + sample] = leftOut[sample];\n           processedRight[offset + sample] = rightOut[sample];\n         }\n\n         if (this.state.playingAt*inputBuffer.sampleRate >= modified.length){\n            source.stop();\n            this.params.currentSource = null;\n            effectNode.disconnect();\n            effectNode.onaudioprocess = null;\n            effector = null;\n            this.setState({startButtonStr: 'Play', saveButtonStr: 'Save'});\n            return;\n          }\n\n          this.counter++;\n          let update = 20;\n          if (this.counter % update === 0) { \n             this.setState({playingAt: this.state.playingAt \n             + (update*inputBuffer.length)/inputBuffer.sampleRate});\n          }\n\n\n          return; \n        }.bind(this) // end onaudioprocess function(e)\n\n        this.setState({startButtonStr: 'Pause'});\n\n        return;\n      } // end Play\n\n      if (this.state.startButtonStr === 'Pause'){\n\n        if (!this.params.isPlaying) return;\n\n        this.params.currentSource.disconnect();\n        this.params.effectNode.disconnect();\n        this.params.effectNode.onaudioprrocess = null;\n        gainNode.disconnect();\n        this.params.currentSource.stop();\n        this.setState({startButtonStr: 'Play'});\n        this.params.isPlaying = false;\n\n        return;\n      } // end Pause\n\n    } // end startPause\n\n    if (e.target.name === 'rewind') {\n      if (this.params.isPlaying) return;\n      this.setState({playingAt: 0});\n      return;\n    }\n\n  } // end handlePlay()\n\n\n  selectFilter(e){\n\n    if (e.target.name === 'selectFilter' && effector !== null) {\n\n      switch(e.target.value){\n        case 'drumCover': \n        case 'karaokeMale': \n        case 'karaokeFemale': \n          effector.presetFilter(e.target.value, this.state.centerWidth);\n        break;\n        case 'percussive': case 'harmonic':\n          effector.presetFilter(e.target.value, 0);\n        break;\n        case 'bypass': \n        case 'customWithGUI': \n          effector.presetFilter('bypass', 0);\n        break; // customWithGUI not implemented\n        default:\n      }\n\n      this.setState({filterType: e.target.value});\n    } \n\n    if (e.target.name === 'centerWidth' \n       && effector !== null && this.state.filterType !== null) {\n       effector.presetFilter(this.state.filterType, parseFloat(e.target.value));\n       this.setState({centerWidth: parseFloat(e.target.value)});\n    }\n\n  }\n\n  handleOffline(e){\n\n    if (e.target.name === 'playBatch') {\n      if (this.state.playBatchButtonStr === 'Play'){\n        // console.log('batchPlay');\n        if (this.params.isPlaying) return;\n\n        let source = audioCtx.createBufferSource()\n        this.params.currentSource = source;\n\n        source.buffer = this.params.outputAudio;\n        source.connect(gainNode);\n        gainNode.connect(audioCtx.destination);\n        source.start(0,this.state.playingAt);\n        this.setState({playBatchButtonStr: 'Pause'});\n        this.params.playStartTime = audioCtx.currentTime;\n        this.params.isPlaying = true;\n\n      } else if (this.state.playBatchButtonStr === 'Pause'){\n        if (!this.params.isPlaying) return;\n\n        this.params.currentSource.stop();\n        this.setState({\n           playingAt: audioCtx.currentTime - this.params.playStartTime\n        });\n      }\n\n      return;\n    }\n\n    if (e.target.name === 'stopBatchPlay'){\n        // console.log('batchPlay Stop');\n\n      if (this.params.currentSource !== null){\n        let source = this.params.currentSource;\n        source.stop();\n        this.params.currentSource = null;\n      }\n      this.params.isPlaying = false;\n      this.setState({playBatchButtonStr: 'Play'});\n      return;\n    }\n\n    if (e.target.name === 'startBatch') {\n\n      if (this.state.processBatchButtonStr === 'Abort'){\n\n        if (this.params.isRendering){\n          this.params.isRendering = false;\n          this.setState({\n            processBatchButtonStr: 'Start',\n            playBatchButtonStr: 'Play'\n          });\n          offlineCtx = null;\n          this.params.outputAudio \n           = this.trimOutput(this.params.outputAudio,\n             this.state.playingAt - this.state.A);\n          this.setState({playingAt: this.state.A});\n         }\n\n        return;\n\n      } else if (this.state.processBatchButtonStr !== 'Start') return;\n\n      let modified = this.addOneSec(this.params.inputAudio,\n           this.state.A*this.params.inputAudio.sampleRate,\n           this.state.B*this.params.inputAudio.sampleRate);\n\n      offlineCtx = new OfflineAudioContext(\n        modified.numberOfChannels, modified.length, modified.sampleRate\n      );\n\n      let source = offlineCtx.createBufferSource();     \n      this.params.currentSource = source;\n      source.buffer = modified;\n\n       let effectNode = null;\n       if (offlineCtx.createJavaScriptNode){ \n         effectNode = offlineCtx.createJavaScriptNode(this.params.fftShift,2,2);\n       } else if (offlineCtx.createScriptProcessor) {\n         effectNode = offlineCtx.createScriptProcessor(this.params.fftShift,2,2)\n       } else {\n         console.log ('offlineCtx scriptprocessor not supported');\n         effectNode = null;\n       }  // end if audioCtx\n       this.params.effectNode = effectNode;\n\n      source.connect(effectNode);\n      effectNode.connect(offlineCtx.destination);\n\n/* To store the result */\n      let output \n        = audioCtx.createBuffer(modified.numberOfChannels, \n           modified.length, modified.sampleRate);\n      this.params.outputAudio = output;\n      let leftOut = output.getChannelData(0);\n      let rightOut = output.getChannelData(1);\n\n      let offset = 0;\n      effectNode.onaudioprocess = function(e) {\n\n         if (!this.params.isRendering) return; // For Abort\n        \n         let input = e.inputBuffer; // input is OK\n         // let output = e.outputBuffer; // does not work as expected\n\n         let processed = audioCtx.createBuffer(2,input.length,input.sampleRate);\n\n         effector.process(input,processed);\n\n         let processedL = processed.getChannelData(0);\n         let processedR = processed.getChannelData(1);\n\n         for (let i = 0; i < input.length; i++){\n            leftOut[offset + i] = processedL[i]; \n            rightOut[offset + i] = processedR[i];\n         }\n\n         if (offset/this.params.fftShift % 20 === 0)  \n            this.setState({playingAt: offset/input.sampleRate});\n\n         offset += this.params.fftShift;\n\n      }.bind(this);\n\n      source.start();\n      this.params.isRendering = true;\n      offlineCtx.startRendering();\n      this.setState({processBatchButtonStr: 'Abort'});\n\n      offlineCtx.oncomplete = function(e) {\n        // e.renderedBuffer; // useless (bug?)\n      }\n\n     return;\n   } // end if testPlay\n\n  } \n\n  addOneSec(inputAudio, begin, end) { // begin, end in sample number\n\n    let modified = audioCtx.createBuffer(\n           inputAudio.numberOfChannels, \n           (end - begin) + inputAudio.sampleRate,\n           inputAudio.sampleRate\n    );\n\n    let inL = inputAudio.getChannelData(0);\n    let inR = inputAudio.getChannelData(1);\n    let outL = modified.getChannelData(0);\n    let outR = modified.getChannelData(1);\n\n    let offset = inputAudio.sampleRate/2;\n    for (let i = 0; i < offset; i++){ outL[i] = 0; outR[i] = 0; }\n    for (let i = begin; i < end; i++){\n      outL[offset + i] = inL[i]; outR[offset + i] = inR[i]; }\n    for (let i = 0; i < offset; i++){ \n      outL[offset + end + i] = 0; outR[offset + end + i] = 0;}\n\n    return modified;\n  }\n\n  handleSave(e){ // offline processing (may work for this)\n\n    if (e.target.name !== 'save') return;\n\n    if (this.params.outputAudio !== null)\n      this.fakeDownload(\n       this.trimOutput(this.params.outputAudio, this.params.outputLength));\n\n  } // end handleSave\n\n\n  trimOutput(audioBuffer,duration){\n\n    let modified = audioCtx.createBuffer(\n           audioBuffer.numberOfChannels, \n           audioBuffer.sampleRate * duration,\n           audioBuffer.sampleRate\n    );\n\n    let inL = audioBuffer.getChannelData(0);\n    let inR = audioBuffer.getChannelData(1);\n    let outL = modified.getChannelData(0);\n    let outR = modified.getChannelData(1);\n\n    for (let i=0; i < modified.length; i++){ \n      outL[i] = inL[i]; \n      outR[i] = inR[i];\n    }\n\n    return modified;\n  }\n\n  fakeDownload(audioBuffer){\n\n    const words = this.params.filename.split('.');\n    let outFileName = words[0] + '-modified.wav';\n    let blob = new Blob([toWav(audioBuffer)], {type: 'audio/vnd.wav'});\n    saveAs(blob,outFileName);\n\n  } // end fakeDownload\n \n} // end class\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}